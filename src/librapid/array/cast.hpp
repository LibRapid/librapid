#pragma once

#include "../internal/config.hpp"
#include "../internal/forward.hpp"
#include "arrayBase.hpp"

namespace librapid {
	namespace internal {
		template<typename DST, typename OtherDerived>
		struct traits<unary::Cast<DST, OtherDerived>> {
			using Scalar				= DST;
			using Packet				= typename traits<Scalar>::Packet;
			using Device				= typename internal::traits<OtherDerived>::Device;
			using StorageType			= memory::DenseStorage<Scalar, Device>;
			static const uint64_t Flags = 0;
		};
	} // namespace internal

	namespace unary {
		template<typename DST, typename OtherDerived>
		class Cast : public ArrayBase<Cast<DST, OtherDerived>,
									  typename internal::traits<OtherDerived>::Device> {
		public:
			using Scalar	  = DST;
			using Packet	  = typename internal::traits<Scalar>::Packet;
			using Device	  = typename internal::traits<OtherDerived>::Device;
			using InputType	  = OtherDerived;
			using InputScalar = typename internal::traits<InputType>::Scalar;
			using Type		  = Cast<DST, OtherDerived>;
			using Base		  = ArrayBase<Cast<DST, OtherDerived>, Device>;

			Cast() = delete;

			Cast(const InputType &toCast) : Base(toCast.extent()), m_toCast(toCast) {}

			Cast(const Type &caster) : Base(caster.extent()), m_toCast(caster) {}

			Cast &operator=(const Type &caster) {
				if (this == &caster) return *this;
				Base::m_extent = caster.m_extent;
				Base::m_data   = caster.m_data;
				m_toCast	   = caster.m_toCast;
				return *this;
			}

			LR_NODISCARD("Do not ignore the result of an evaluated calculation")
			Array<Scalar, Device> eval() const {
				Array<Scalar, Device> res(Base::extent());
				res.assign(*this);
				return res;
			}

			LR_FORCE_INLINE Packet packet(int64_t index) const {
				// Quick return if possible
				if constexpr (std::is_same_v<Scalar, InputScalar>) return m_toCast.packet(index);

				if constexpr (internal::traits<Scalar>::PacketWidth == 4) {
					return Packet(m_toCast.scalar(index + 0),
								  m_toCast.scalar(index + 1),
								  m_toCast.scalar(index + 2),
								  m_toCast.scalar(index + 3));
				}

				if constexpr (internal::traits<Scalar>::PacketWidth == 8) {
					return Packet(m_toCast.scalar(index + 0),
								  m_toCast.scalar(index + 1),
								  m_toCast.scalar(index + 2),
								  m_toCast.scalar(index + 3),
								  m_toCast.scalar(index + 4),
								  m_toCast.scalar(index + 5),
								  m_toCast.scalar(index + 6),
								  m_toCast.scalar(index + 7));
				}

				if constexpr (internal::traits<Scalar>::PacketWidth == 16) {
					return Packet(m_toCast.scalar(index + 0),
								  m_toCast.scalar(index + 1),
								  m_toCast.scalar(index + 2),
								  m_toCast.scalar(index + 3),
								  m_toCast.scalar(index + 4),
								  m_toCast.scalar(index + 5),
								  m_toCast.scalar(index + 6),
								  m_toCast.scalar(index + 7),
								  m_toCast.scalar(index + 8),
								  m_toCast.scalar(index + 9),
								  m_toCast.scalar(index + 10),
								  m_toCast.scalar(index + 11),
								  m_toCast.scalar(index + 12),
								  m_toCast.scalar(index + 13),
								  m_toCast.scalar(index + 14),
								  m_toCast.scalar(index + 15));
				}

				if constexpr (internal::traits<Scalar>::PacketWidth == 32) {
					return Packet(m_toCast.scalar(index + 0),
								  m_toCast.scalar(index + 1),
								  m_toCast.scalar(index + 2),
								  m_toCast.scalar(index + 3),
								  m_toCast.scalar(index + 4),
								  m_toCast.scalar(index + 5),
								  m_toCast.scalar(index + 6),
								  m_toCast.scalar(index + 7),
								  m_toCast.scalar(index + 8),
								  m_toCast.scalar(index + 9),
								  m_toCast.scalar(index + 10),
								  m_toCast.scalar(index + 11),
								  m_toCast.scalar(index + 12),
								  m_toCast.scalar(index + 13),
								  m_toCast.scalar(index + 14),
								  m_toCast.scalar(index + 15),
								  m_toCast.scalar(index + 16),
								  m_toCast.scalar(index + 17),
								  m_toCast.scalar(index + 18),
								  m_toCast.scalar(index + 19),
								  m_toCast.scalar(index + 20),
								  m_toCast.scalar(index + 21),
								  m_toCast.scalar(index + 22),
								  m_toCast.scalar(index + 23),
								  m_toCast.scalar(index + 24),
								  m_toCast.scalar(index + 25),
								  m_toCast.scalar(index + 26),
								  m_toCast.scalar(index + 27),
								  m_toCast.scalar(index + 28),
								  m_toCast.scalar(index + 29),
								  m_toCast.scalar(index + 30),
								  m_toCast.scalar(index + 31));
				}

				if constexpr (internal::traits<Scalar>::PacketWidth == 64) {
					return Packet(m_toCast.scalar(index + 0),
								  m_toCast.scalar(index + 1),
								  m_toCast.scalar(index + 2),
								  m_toCast.scalar(index + 3),
								  m_toCast.scalar(index + 4),
								  m_toCast.scalar(index + 5),
								  m_toCast.scalar(index + 6),
								  m_toCast.scalar(index + 7),
								  m_toCast.scalar(index + 8),
								  m_toCast.scalar(index + 9),
								  m_toCast.scalar(index + 10),
								  m_toCast.scalar(index + 11),
								  m_toCast.scalar(index + 12),
								  m_toCast.scalar(index + 13),
								  m_toCast.scalar(index + 14),
								  m_toCast.scalar(index + 15),
								  m_toCast.scalar(index + 16),
								  m_toCast.scalar(index + 17),
								  m_toCast.scalar(index + 18),
								  m_toCast.scalar(index + 19),
								  m_toCast.scalar(index + 20),
								  m_toCast.scalar(index + 21),
								  m_toCast.scalar(index + 22),
								  m_toCast.scalar(index + 23),
								  m_toCast.scalar(index + 24),
								  m_toCast.scalar(index + 25),
								  m_toCast.scalar(index + 26),
								  m_toCast.scalar(index + 27),
								  m_toCast.scalar(index + 28),
								  m_toCast.scalar(index + 29),
								  m_toCast.scalar(index + 30),
								  m_toCast.scalar(index + 31),
								  m_toCast.scalar(index + 32),
								  m_toCast.scalar(index + 33),
								  m_toCast.scalar(index + 34),
								  m_toCast.scalar(index + 35),
								  m_toCast.scalar(index + 36),
								  m_toCast.scalar(index + 37),
								  m_toCast.scalar(index + 38),
								  m_toCast.scalar(index + 39),
								  m_toCast.scalar(index + 40),
								  m_toCast.scalar(index + 41),
								  m_toCast.scalar(index + 42),
								  m_toCast.scalar(index + 43),
								  m_toCast.scalar(index + 44),
								  m_toCast.scalar(index + 45),
								  m_toCast.scalar(index + 46),
								  m_toCast.scalar(index + 47),
								  m_toCast.scalar(index + 48),
								  m_toCast.scalar(index + 49),
								  m_toCast.scalar(index + 50),
								  m_toCast.scalar(index + 51),
								  m_toCast.scalar(index + 52),
								  m_toCast.scalar(index + 53),
								  m_toCast.scalar(index + 54),
								  m_toCast.scalar(index + 55),
								  m_toCast.scalar(index + 56),
								  m_toCast.scalar(index + 57),
								  m_toCast.scalar(index + 58),
								  m_toCast.scalar(index + 59),
								  m_toCast.scalar(index + 60),
								  m_toCast.scalar(index + 61),
								  m_toCast.scalar(index + 62),
								  m_toCast.scalar(index + 63));
				}

				if constexpr (internal::traits<Scalar>::PacketWidth == 128) {
					return Packet(m_toCast.scalar(index + 0),
								  m_toCast.scalar(index + 1),
								  m_toCast.scalar(index + 2),
								  m_toCast.scalar(index + 3),
								  m_toCast.scalar(index + 4),
								  m_toCast.scalar(index + 5),
								  m_toCast.scalar(index + 6),
								  m_toCast.scalar(index + 7),
								  m_toCast.scalar(index + 8),
								  m_toCast.scalar(index + 9),
								  m_toCast.scalar(index + 10),
								  m_toCast.scalar(index + 11),
								  m_toCast.scalar(index + 12),
								  m_toCast.scalar(index + 13),
								  m_toCast.scalar(index + 14),
								  m_toCast.scalar(index + 15),
								  m_toCast.scalar(index + 16),
								  m_toCast.scalar(index + 17),
								  m_toCast.scalar(index + 18),
								  m_toCast.scalar(index + 19),
								  m_toCast.scalar(index + 20),
								  m_toCast.scalar(index + 21),
								  m_toCast.scalar(index + 22),
								  m_toCast.scalar(index + 23),
								  m_toCast.scalar(index + 24),
								  m_toCast.scalar(index + 25),
								  m_toCast.scalar(index + 26),
								  m_toCast.scalar(index + 27),
								  m_toCast.scalar(index + 28),
								  m_toCast.scalar(index + 29),
								  m_toCast.scalar(index + 30),
								  m_toCast.scalar(index + 31),
								  m_toCast.scalar(index + 32),
								  m_toCast.scalar(index + 33),
								  m_toCast.scalar(index + 34),
								  m_toCast.scalar(index + 35),
								  m_toCast.scalar(index + 36),
								  m_toCast.scalar(index + 37),
								  m_toCast.scalar(index + 38),
								  m_toCast.scalar(index + 39),
								  m_toCast.scalar(index + 40),
								  m_toCast.scalar(index + 41),
								  m_toCast.scalar(index + 42),
								  m_toCast.scalar(index + 43),
								  m_toCast.scalar(index + 44),
								  m_toCast.scalar(index + 45),
								  m_toCast.scalar(index + 46),
								  m_toCast.scalar(index + 47),
								  m_toCast.scalar(index + 48),
								  m_toCast.scalar(index + 49),
								  m_toCast.scalar(index + 50),
								  m_toCast.scalar(index + 51),
								  m_toCast.scalar(index + 52),
								  m_toCast.scalar(index + 53),
								  m_toCast.scalar(index + 54),
								  m_toCast.scalar(index + 55),
								  m_toCast.scalar(index + 56),
								  m_toCast.scalar(index + 57),
								  m_toCast.scalar(index + 58),
								  m_toCast.scalar(index + 59),
								  m_toCast.scalar(index + 60),
								  m_toCast.scalar(index + 61),
								  m_toCast.scalar(index + 62),
								  m_toCast.scalar(index + 63),
								  m_toCast.scalar(index + 64),
								  m_toCast.scalar(index + 65),
								  m_toCast.scalar(index + 66),
								  m_toCast.scalar(index + 67),
								  m_toCast.scalar(index + 68),
								  m_toCast.scalar(index + 69),
								  m_toCast.scalar(index + 70),
								  m_toCast.scalar(index + 71),
								  m_toCast.scalar(index + 72),
								  m_toCast.scalar(index + 73),
								  m_toCast.scalar(index + 74),
								  m_toCast.scalar(index + 75),
								  m_toCast.scalar(index + 76),
								  m_toCast.scalar(index + 77),
								  m_toCast.scalar(index + 78),
								  m_toCast.scalar(index + 79),
								  m_toCast.scalar(index + 80),
								  m_toCast.scalar(index + 81),
								  m_toCast.scalar(index + 82),
								  m_toCast.scalar(index + 83),
								  m_toCast.scalar(index + 84),
								  m_toCast.scalar(index + 85),
								  m_toCast.scalar(index + 86),
								  m_toCast.scalar(index + 87),
								  m_toCast.scalar(index + 88),
								  m_toCast.scalar(index + 89),
								  m_toCast.scalar(index + 90),
								  m_toCast.scalar(index + 91),
								  m_toCast.scalar(index + 92),
								  m_toCast.scalar(index + 93),
								  m_toCast.scalar(index + 94),
								  m_toCast.scalar(index + 95),
								  m_toCast.scalar(index + 96),
								  m_toCast.scalar(index + 97),
								  m_toCast.scalar(index + 98),
								  m_toCast.scalar(index + 99),
								  m_toCast.scalar(index + 100),
								  m_toCast.scalar(index + 101),
								  m_toCast.scalar(index + 102),
								  m_toCast.scalar(index + 103),
								  m_toCast.scalar(index + 104),
								  m_toCast.scalar(index + 105),
								  m_toCast.scalar(index + 106),
								  m_toCast.scalar(index + 107),
								  m_toCast.scalar(index + 108),
								  m_toCast.scalar(index + 109),
								  m_toCast.scalar(index + 110),
								  m_toCast.scalar(index + 111),
								  m_toCast.scalar(index + 112),
								  m_toCast.scalar(index + 113),
								  m_toCast.scalar(index + 114),
								  m_toCast.scalar(index + 115),
								  m_toCast.scalar(index + 116),
								  m_toCast.scalar(index + 117),
								  m_toCast.scalar(index + 118),
								  m_toCast.scalar(index + 119),
								  m_toCast.scalar(index + 120),
								  m_toCast.scalar(index + 121),
								  m_toCast.scalar(index + 122),
								  m_toCast.scalar(index + 123),
								  m_toCast.scalar(index + 124),
								  m_toCast.scalar(index + 125),
								  m_toCast.scalar(index + 126),
								  m_toCast.scalar(index + 127));
				}

				if constexpr (internal::traits<Scalar>::PacketWidth == 256) {
					return Packet(m_toCast.scalar(index + 0),
								  m_toCast.scalar(index + 1),
								  m_toCast.scalar(index + 2),
								  m_toCast.scalar(index + 3),
								  m_toCast.scalar(index + 4),
								  m_toCast.scalar(index + 5),
								  m_toCast.scalar(index + 6),
								  m_toCast.scalar(index + 7),
								  m_toCast.scalar(index + 8),
								  m_toCast.scalar(index + 9),
								  m_toCast.scalar(index + 10),
								  m_toCast.scalar(index + 11),
								  m_toCast.scalar(index + 12),
								  m_toCast.scalar(index + 13),
								  m_toCast.scalar(index + 14),
								  m_toCast.scalar(index + 15),
								  m_toCast.scalar(index + 16),
								  m_toCast.scalar(index + 17),
								  m_toCast.scalar(index + 18),
								  m_toCast.scalar(index + 19),
								  m_toCast.scalar(index + 20),
								  m_toCast.scalar(index + 21),
								  m_toCast.scalar(index + 22),
								  m_toCast.scalar(index + 23),
								  m_toCast.scalar(index + 24),
								  m_toCast.scalar(index + 25),
								  m_toCast.scalar(index + 26),
								  m_toCast.scalar(index + 27),
								  m_toCast.scalar(index + 28),
								  m_toCast.scalar(index + 29),
								  m_toCast.scalar(index + 30),
								  m_toCast.scalar(index + 31),
								  m_toCast.scalar(index + 32),
								  m_toCast.scalar(index + 33),
								  m_toCast.scalar(index + 34),
								  m_toCast.scalar(index + 35),
								  m_toCast.scalar(index + 36),
								  m_toCast.scalar(index + 37),
								  m_toCast.scalar(index + 38),
								  m_toCast.scalar(index + 39),
								  m_toCast.scalar(index + 40),
								  m_toCast.scalar(index + 41),
								  m_toCast.scalar(index + 42),
								  m_toCast.scalar(index + 43),
								  m_toCast.scalar(index + 44),
								  m_toCast.scalar(index + 45),
								  m_toCast.scalar(index + 46),
								  m_toCast.scalar(index + 47),
								  m_toCast.scalar(index + 48),
								  m_toCast.scalar(index + 49),
								  m_toCast.scalar(index + 50),
								  m_toCast.scalar(index + 51),
								  m_toCast.scalar(index + 52),
								  m_toCast.scalar(index + 53),
								  m_toCast.scalar(index + 54),
								  m_toCast.scalar(index + 55),
								  m_toCast.scalar(index + 56),
								  m_toCast.scalar(index + 57),
								  m_toCast.scalar(index + 58),
								  m_toCast.scalar(index + 59),
								  m_toCast.scalar(index + 60),
								  m_toCast.scalar(index + 61),
								  m_toCast.scalar(index + 62),
								  m_toCast.scalar(index + 63),
								  m_toCast.scalar(index + 64),
								  m_toCast.scalar(index + 65),
								  m_toCast.scalar(index + 66),
								  m_toCast.scalar(index + 67),
								  m_toCast.scalar(index + 68),
								  m_toCast.scalar(index + 69),
								  m_toCast.scalar(index + 70),
								  m_toCast.scalar(index + 71),
								  m_toCast.scalar(index + 72),
								  m_toCast.scalar(index + 73),
								  m_toCast.scalar(index + 74),
								  m_toCast.scalar(index + 75),
								  m_toCast.scalar(index + 76),
								  m_toCast.scalar(index + 77),
								  m_toCast.scalar(index + 78),
								  m_toCast.scalar(index + 79),
								  m_toCast.scalar(index + 80),
								  m_toCast.scalar(index + 81),
								  m_toCast.scalar(index + 82),
								  m_toCast.scalar(index + 83),
								  m_toCast.scalar(index + 84),
								  m_toCast.scalar(index + 85),
								  m_toCast.scalar(index + 86),
								  m_toCast.scalar(index + 87),
								  m_toCast.scalar(index + 88),
								  m_toCast.scalar(index + 89),
								  m_toCast.scalar(index + 90),
								  m_toCast.scalar(index + 91),
								  m_toCast.scalar(index + 92),
								  m_toCast.scalar(index + 93),
								  m_toCast.scalar(index + 94),
								  m_toCast.scalar(index + 95),
								  m_toCast.scalar(index + 96),
								  m_toCast.scalar(index + 97),
								  m_toCast.scalar(index + 98),
								  m_toCast.scalar(index + 99),
								  m_toCast.scalar(index + 100),
								  m_toCast.scalar(index + 101),
								  m_toCast.scalar(index + 102),
								  m_toCast.scalar(index + 103),
								  m_toCast.scalar(index + 104),
								  m_toCast.scalar(index + 105),
								  m_toCast.scalar(index + 106),
								  m_toCast.scalar(index + 107),
								  m_toCast.scalar(index + 108),
								  m_toCast.scalar(index + 109),
								  m_toCast.scalar(index + 110),
								  m_toCast.scalar(index + 111),
								  m_toCast.scalar(index + 112),
								  m_toCast.scalar(index + 113),
								  m_toCast.scalar(index + 114),
								  m_toCast.scalar(index + 115),
								  m_toCast.scalar(index + 116),
								  m_toCast.scalar(index + 117),
								  m_toCast.scalar(index + 118),
								  m_toCast.scalar(index + 119),
								  m_toCast.scalar(index + 120),
								  m_toCast.scalar(index + 121),
								  m_toCast.scalar(index + 122),
								  m_toCast.scalar(index + 123),
								  m_toCast.scalar(index + 124),
								  m_toCast.scalar(index + 125),
								  m_toCast.scalar(index + 126),
								  m_toCast.scalar(index + 127),
								  m_toCast.scalar(index + 128),
								  m_toCast.scalar(index + 129),
								  m_toCast.scalar(index + 130),
								  m_toCast.scalar(index + 131),
								  m_toCast.scalar(index + 132),
								  m_toCast.scalar(index + 133),
								  m_toCast.scalar(index + 134),
								  m_toCast.scalar(index + 135),
								  m_toCast.scalar(index + 136),
								  m_toCast.scalar(index + 137),
								  m_toCast.scalar(index + 138),
								  m_toCast.scalar(index + 139),
								  m_toCast.scalar(index + 140),
								  m_toCast.scalar(index + 141),
								  m_toCast.scalar(index + 142),
								  m_toCast.scalar(index + 143),
								  m_toCast.scalar(index + 144),
								  m_toCast.scalar(index + 145),
								  m_toCast.scalar(index + 146),
								  m_toCast.scalar(index + 147),
								  m_toCast.scalar(index + 148),
								  m_toCast.scalar(index + 149),
								  m_toCast.scalar(index + 150),
								  m_toCast.scalar(index + 151),
								  m_toCast.scalar(index + 152),
								  m_toCast.scalar(index + 153),
								  m_toCast.scalar(index + 154),
								  m_toCast.scalar(index + 155),
								  m_toCast.scalar(index + 156),
								  m_toCast.scalar(index + 157),
								  m_toCast.scalar(index + 158),
								  m_toCast.scalar(index + 159),
								  m_toCast.scalar(index + 160),
								  m_toCast.scalar(index + 161),
								  m_toCast.scalar(index + 162),
								  m_toCast.scalar(index + 163),
								  m_toCast.scalar(index + 164),
								  m_toCast.scalar(index + 165),
								  m_toCast.scalar(index + 166),
								  m_toCast.scalar(index + 167),
								  m_toCast.scalar(index + 168),
								  m_toCast.scalar(index + 169),
								  m_toCast.scalar(index + 170),
								  m_toCast.scalar(index + 171),
								  m_toCast.scalar(index + 172),
								  m_toCast.scalar(index + 173),
								  m_toCast.scalar(index + 174),
								  m_toCast.scalar(index + 175),
								  m_toCast.scalar(index + 176),
								  m_toCast.scalar(index + 177),
								  m_toCast.scalar(index + 178),
								  m_toCast.scalar(index + 179),
								  m_toCast.scalar(index + 180),
								  m_toCast.scalar(index + 181),
								  m_toCast.scalar(index + 182),
								  m_toCast.scalar(index + 183),
								  m_toCast.scalar(index + 184),
								  m_toCast.scalar(index + 185),
								  m_toCast.scalar(index + 186),
								  m_toCast.scalar(index + 187),
								  m_toCast.scalar(index + 188),
								  m_toCast.scalar(index + 189),
								  m_toCast.scalar(index + 190),
								  m_toCast.scalar(index + 191),
								  m_toCast.scalar(index + 192),
								  m_toCast.scalar(index + 193),
								  m_toCast.scalar(index + 194),
								  m_toCast.scalar(index + 195),
								  m_toCast.scalar(index + 196),
								  m_toCast.scalar(index + 197),
								  m_toCast.scalar(index + 198),
								  m_toCast.scalar(index + 199),
								  m_toCast.scalar(index + 200),
								  m_toCast.scalar(index + 201),
								  m_toCast.scalar(index + 202),
								  m_toCast.scalar(index + 203),
								  m_toCast.scalar(index + 204),
								  m_toCast.scalar(index + 205),
								  m_toCast.scalar(index + 206),
								  m_toCast.scalar(index + 207),
								  m_toCast.scalar(index + 208),
								  m_toCast.scalar(index + 209),
								  m_toCast.scalar(index + 210),
								  m_toCast.scalar(index + 211),
								  m_toCast.scalar(index + 212),
								  m_toCast.scalar(index + 213),
								  m_toCast.scalar(index + 214),
								  m_toCast.scalar(index + 215),
								  m_toCast.scalar(index + 216),
								  m_toCast.scalar(index + 217),
								  m_toCast.scalar(index + 218),
								  m_toCast.scalar(index + 219),
								  m_toCast.scalar(index + 220),
								  m_toCast.scalar(index + 221),
								  m_toCast.scalar(index + 222),
								  m_toCast.scalar(index + 223),
								  m_toCast.scalar(index + 224),
								  m_toCast.scalar(index + 225),
								  m_toCast.scalar(index + 226),
								  m_toCast.scalar(index + 227),
								  m_toCast.scalar(index + 228),
								  m_toCast.scalar(index + 229),
								  m_toCast.scalar(index + 230),
								  m_toCast.scalar(index + 231),
								  m_toCast.scalar(index + 232),
								  m_toCast.scalar(index + 233),
								  m_toCast.scalar(index + 234),
								  m_toCast.scalar(index + 235),
								  m_toCast.scalar(index + 236),
								  m_toCast.scalar(index + 237),
								  m_toCast.scalar(index + 238),
								  m_toCast.scalar(index + 239),
								  m_toCast.scalar(index + 240),
								  m_toCast.scalar(index + 241),
								  m_toCast.scalar(index + 242),
								  m_toCast.scalar(index + 243),
								  m_toCast.scalar(index + 244),
								  m_toCast.scalar(index + 245),
								  m_toCast.scalar(index + 246),
								  m_toCast.scalar(index + 247),
								  m_toCast.scalar(index + 248),
								  m_toCast.scalar(index + 249),
								  m_toCast.scalar(index + 250),
								  m_toCast.scalar(index + 251),
								  m_toCast.scalar(index + 252),
								  m_toCast.scalar(index + 253),
								  m_toCast.scalar(index + 254),
								  m_toCast.scalar(index + 255));
				}

				if constexpr (internal::traits<Scalar>::PacketWidth == 512) {
					return Packet(m_toCast.scalar(index + 0),
								  m_toCast.scalar(index + 1),
								  m_toCast.scalar(index + 2),
								  m_toCast.scalar(index + 3),
								  m_toCast.scalar(index + 4),
								  m_toCast.scalar(index + 5),
								  m_toCast.scalar(index + 6),
								  m_toCast.scalar(index + 7),
								  m_toCast.scalar(index + 8),
								  m_toCast.scalar(index + 9),
								  m_toCast.scalar(index + 10),
								  m_toCast.scalar(index + 11),
								  m_toCast.scalar(index + 12),
								  m_toCast.scalar(index + 13),
								  m_toCast.scalar(index + 14),
								  m_toCast.scalar(index + 15),
								  m_toCast.scalar(index + 16),
								  m_toCast.scalar(index + 17),
								  m_toCast.scalar(index + 18),
								  m_toCast.scalar(index + 19),
								  m_toCast.scalar(index + 20),
								  m_toCast.scalar(index + 21),
								  m_toCast.scalar(index + 22),
								  m_toCast.scalar(index + 23),
								  m_toCast.scalar(index + 24),
								  m_toCast.scalar(index + 25),
								  m_toCast.scalar(index + 26),
								  m_toCast.scalar(index + 27),
								  m_toCast.scalar(index + 28),
								  m_toCast.scalar(index + 29),
								  m_toCast.scalar(index + 30),
								  m_toCast.scalar(index + 31),
								  m_toCast.scalar(index + 32),
								  m_toCast.scalar(index + 33),
								  m_toCast.scalar(index + 34),
								  m_toCast.scalar(index + 35),
								  m_toCast.scalar(index + 36),
								  m_toCast.scalar(index + 37),
								  m_toCast.scalar(index + 38),
								  m_toCast.scalar(index + 39),
								  m_toCast.scalar(index + 40),
								  m_toCast.scalar(index + 41),
								  m_toCast.scalar(index + 42),
								  m_toCast.scalar(index + 43),
								  m_toCast.scalar(index + 44),
								  m_toCast.scalar(index + 45),
								  m_toCast.scalar(index + 46),
								  m_toCast.scalar(index + 47),
								  m_toCast.scalar(index + 48),
								  m_toCast.scalar(index + 49),
								  m_toCast.scalar(index + 50),
								  m_toCast.scalar(index + 51),
								  m_toCast.scalar(index + 52),
								  m_toCast.scalar(index + 53),
								  m_toCast.scalar(index + 54),
								  m_toCast.scalar(index + 55),
								  m_toCast.scalar(index + 56),
								  m_toCast.scalar(index + 57),
								  m_toCast.scalar(index + 58),
								  m_toCast.scalar(index + 59),
								  m_toCast.scalar(index + 60),
								  m_toCast.scalar(index + 61),
								  m_toCast.scalar(index + 62),
								  m_toCast.scalar(index + 63),
								  m_toCast.scalar(index + 64),
								  m_toCast.scalar(index + 65),
								  m_toCast.scalar(index + 66),
								  m_toCast.scalar(index + 67),
								  m_toCast.scalar(index + 68),
								  m_toCast.scalar(index + 69),
								  m_toCast.scalar(index + 70),
								  m_toCast.scalar(index + 71),
								  m_toCast.scalar(index + 72),
								  m_toCast.scalar(index + 73),
								  m_toCast.scalar(index + 74),
								  m_toCast.scalar(index + 75),
								  m_toCast.scalar(index + 76),
								  m_toCast.scalar(index + 77),
								  m_toCast.scalar(index + 78),
								  m_toCast.scalar(index + 79),
								  m_toCast.scalar(index + 80),
								  m_toCast.scalar(index + 81),
								  m_toCast.scalar(index + 82),
								  m_toCast.scalar(index + 83),
								  m_toCast.scalar(index + 84),
								  m_toCast.scalar(index + 85),
								  m_toCast.scalar(index + 86),
								  m_toCast.scalar(index + 87),
								  m_toCast.scalar(index + 88),
								  m_toCast.scalar(index + 89),
								  m_toCast.scalar(index + 90),
								  m_toCast.scalar(index + 91),
								  m_toCast.scalar(index + 92),
								  m_toCast.scalar(index + 93),
								  m_toCast.scalar(index + 94),
								  m_toCast.scalar(index + 95),
								  m_toCast.scalar(index + 96),
								  m_toCast.scalar(index + 97),
								  m_toCast.scalar(index + 98),
								  m_toCast.scalar(index + 99),
								  m_toCast.scalar(index + 100),
								  m_toCast.scalar(index + 101),
								  m_toCast.scalar(index + 102),
								  m_toCast.scalar(index + 103),
								  m_toCast.scalar(index + 104),
								  m_toCast.scalar(index + 105),
								  m_toCast.scalar(index + 106),
								  m_toCast.scalar(index + 107),
								  m_toCast.scalar(index + 108),
								  m_toCast.scalar(index + 109),
								  m_toCast.scalar(index + 110),
								  m_toCast.scalar(index + 111),
								  m_toCast.scalar(index + 112),
								  m_toCast.scalar(index + 113),
								  m_toCast.scalar(index + 114),
								  m_toCast.scalar(index + 115),
								  m_toCast.scalar(index + 116),
								  m_toCast.scalar(index + 117),
								  m_toCast.scalar(index + 118),
								  m_toCast.scalar(index + 119),
								  m_toCast.scalar(index + 120),
								  m_toCast.scalar(index + 121),
								  m_toCast.scalar(index + 122),
								  m_toCast.scalar(index + 123),
								  m_toCast.scalar(index + 124),
								  m_toCast.scalar(index + 125),
								  m_toCast.scalar(index + 126),
								  m_toCast.scalar(index + 127),
								  m_toCast.scalar(index + 128),
								  m_toCast.scalar(index + 129),
								  m_toCast.scalar(index + 130),
								  m_toCast.scalar(index + 131),
								  m_toCast.scalar(index + 132),
								  m_toCast.scalar(index + 133),
								  m_toCast.scalar(index + 134),
								  m_toCast.scalar(index + 135),
								  m_toCast.scalar(index + 136),
								  m_toCast.scalar(index + 137),
								  m_toCast.scalar(index + 138),
								  m_toCast.scalar(index + 139),
								  m_toCast.scalar(index + 140),
								  m_toCast.scalar(index + 141),
								  m_toCast.scalar(index + 142),
								  m_toCast.scalar(index + 143),
								  m_toCast.scalar(index + 144),
								  m_toCast.scalar(index + 145),
								  m_toCast.scalar(index + 146),
								  m_toCast.scalar(index + 147),
								  m_toCast.scalar(index + 148),
								  m_toCast.scalar(index + 149),
								  m_toCast.scalar(index + 150),
								  m_toCast.scalar(index + 151),
								  m_toCast.scalar(index + 152),
								  m_toCast.scalar(index + 153),
								  m_toCast.scalar(index + 154),
								  m_toCast.scalar(index + 155),
								  m_toCast.scalar(index + 156),
								  m_toCast.scalar(index + 157),
								  m_toCast.scalar(index + 158),
								  m_toCast.scalar(index + 159),
								  m_toCast.scalar(index + 160),
								  m_toCast.scalar(index + 161),
								  m_toCast.scalar(index + 162),
								  m_toCast.scalar(index + 163),
								  m_toCast.scalar(index + 164),
								  m_toCast.scalar(index + 165),
								  m_toCast.scalar(index + 166),
								  m_toCast.scalar(index + 167),
								  m_toCast.scalar(index + 168),
								  m_toCast.scalar(index + 169),
								  m_toCast.scalar(index + 170),
								  m_toCast.scalar(index + 171),
								  m_toCast.scalar(index + 172),
								  m_toCast.scalar(index + 173),
								  m_toCast.scalar(index + 174),
								  m_toCast.scalar(index + 175),
								  m_toCast.scalar(index + 176),
								  m_toCast.scalar(index + 177),
								  m_toCast.scalar(index + 178),
								  m_toCast.scalar(index + 179),
								  m_toCast.scalar(index + 180),
								  m_toCast.scalar(index + 181),
								  m_toCast.scalar(index + 182),
								  m_toCast.scalar(index + 183),
								  m_toCast.scalar(index + 184),
								  m_toCast.scalar(index + 185),
								  m_toCast.scalar(index + 186),
								  m_toCast.scalar(index + 187),
								  m_toCast.scalar(index + 188),
								  m_toCast.scalar(index + 189),
								  m_toCast.scalar(index + 190),
								  m_toCast.scalar(index + 191),
								  m_toCast.scalar(index + 192),
								  m_toCast.scalar(index + 193),
								  m_toCast.scalar(index + 194),
								  m_toCast.scalar(index + 195),
								  m_toCast.scalar(index + 196),
								  m_toCast.scalar(index + 197),
								  m_toCast.scalar(index + 198),
								  m_toCast.scalar(index + 199),
								  m_toCast.scalar(index + 200),
								  m_toCast.scalar(index + 201),
								  m_toCast.scalar(index + 202),
								  m_toCast.scalar(index + 203),
								  m_toCast.scalar(index + 204),
								  m_toCast.scalar(index + 205),
								  m_toCast.scalar(index + 206),
								  m_toCast.scalar(index + 207),
								  m_toCast.scalar(index + 208),
								  m_toCast.scalar(index + 209),
								  m_toCast.scalar(index + 210),
								  m_toCast.scalar(index + 211),
								  m_toCast.scalar(index + 212),
								  m_toCast.scalar(index + 213),
								  m_toCast.scalar(index + 214),
								  m_toCast.scalar(index + 215),
								  m_toCast.scalar(index + 216),
								  m_toCast.scalar(index + 217),
								  m_toCast.scalar(index + 218),
								  m_toCast.scalar(index + 219),
								  m_toCast.scalar(index + 220),
								  m_toCast.scalar(index + 221),
								  m_toCast.scalar(index + 222),
								  m_toCast.scalar(index + 223),
								  m_toCast.scalar(index + 224),
								  m_toCast.scalar(index + 225),
								  m_toCast.scalar(index + 226),
								  m_toCast.scalar(index + 227),
								  m_toCast.scalar(index + 228),
								  m_toCast.scalar(index + 229),
								  m_toCast.scalar(index + 230),
								  m_toCast.scalar(index + 231),
								  m_toCast.scalar(index + 232),
								  m_toCast.scalar(index + 233),
								  m_toCast.scalar(index + 234),
								  m_toCast.scalar(index + 235),
								  m_toCast.scalar(index + 236),
								  m_toCast.scalar(index + 237),
								  m_toCast.scalar(index + 238),
								  m_toCast.scalar(index + 239),
								  m_toCast.scalar(index + 240),
								  m_toCast.scalar(index + 241),
								  m_toCast.scalar(index + 242),
								  m_toCast.scalar(index + 243),
								  m_toCast.scalar(index + 244),
								  m_toCast.scalar(index + 245),
								  m_toCast.scalar(index + 246),
								  m_toCast.scalar(index + 247),
								  m_toCast.scalar(index + 248),
								  m_toCast.scalar(index + 249),
								  m_toCast.scalar(index + 250),
								  m_toCast.scalar(index + 251),
								  m_toCast.scalar(index + 252),
								  m_toCast.scalar(index + 253),
								  m_toCast.scalar(index + 254),
								  m_toCast.scalar(index + 255),
								  m_toCast.scalar(index + 256),
								  m_toCast.scalar(index + 257),
								  m_toCast.scalar(index + 258),
								  m_toCast.scalar(index + 259),
								  m_toCast.scalar(index + 260),
								  m_toCast.scalar(index + 261),
								  m_toCast.scalar(index + 262),
								  m_toCast.scalar(index + 263),
								  m_toCast.scalar(index + 264),
								  m_toCast.scalar(index + 265),
								  m_toCast.scalar(index + 266),
								  m_toCast.scalar(index + 267),
								  m_toCast.scalar(index + 268),
								  m_toCast.scalar(index + 269),
								  m_toCast.scalar(index + 270),
								  m_toCast.scalar(index + 271),
								  m_toCast.scalar(index + 272),
								  m_toCast.scalar(index + 273),
								  m_toCast.scalar(index + 274),
								  m_toCast.scalar(index + 275),
								  m_toCast.scalar(index + 276),
								  m_toCast.scalar(index + 277),
								  m_toCast.scalar(index + 278),
								  m_toCast.scalar(index + 279),
								  m_toCast.scalar(index + 280),
								  m_toCast.scalar(index + 281),
								  m_toCast.scalar(index + 282),
								  m_toCast.scalar(index + 283),
								  m_toCast.scalar(index + 284),
								  m_toCast.scalar(index + 285),
								  m_toCast.scalar(index + 286),
								  m_toCast.scalar(index + 287),
								  m_toCast.scalar(index + 288),
								  m_toCast.scalar(index + 289),
								  m_toCast.scalar(index + 290),
								  m_toCast.scalar(index + 291),
								  m_toCast.scalar(index + 292),
								  m_toCast.scalar(index + 293),
								  m_toCast.scalar(index + 294),
								  m_toCast.scalar(index + 295),
								  m_toCast.scalar(index + 296),
								  m_toCast.scalar(index + 297),
								  m_toCast.scalar(index + 298),
								  m_toCast.scalar(index + 299),
								  m_toCast.scalar(index + 300),
								  m_toCast.scalar(index + 301),
								  m_toCast.scalar(index + 302),
								  m_toCast.scalar(index + 303),
								  m_toCast.scalar(index + 304),
								  m_toCast.scalar(index + 305),
								  m_toCast.scalar(index + 306),
								  m_toCast.scalar(index + 307),
								  m_toCast.scalar(index + 308),
								  m_toCast.scalar(index + 309),
								  m_toCast.scalar(index + 310),
								  m_toCast.scalar(index + 311),
								  m_toCast.scalar(index + 312),
								  m_toCast.scalar(index + 313),
								  m_toCast.scalar(index + 314),
								  m_toCast.scalar(index + 315),
								  m_toCast.scalar(index + 316),
								  m_toCast.scalar(index + 317),
								  m_toCast.scalar(index + 318),
								  m_toCast.scalar(index + 319),
								  m_toCast.scalar(index + 320),
								  m_toCast.scalar(index + 321),
								  m_toCast.scalar(index + 322),
								  m_toCast.scalar(index + 323),
								  m_toCast.scalar(index + 324),
								  m_toCast.scalar(index + 325),
								  m_toCast.scalar(index + 326),
								  m_toCast.scalar(index + 327),
								  m_toCast.scalar(index + 328),
								  m_toCast.scalar(index + 329),
								  m_toCast.scalar(index + 330),
								  m_toCast.scalar(index + 331),
								  m_toCast.scalar(index + 332),
								  m_toCast.scalar(index + 333),
								  m_toCast.scalar(index + 334),
								  m_toCast.scalar(index + 335),
								  m_toCast.scalar(index + 336),
								  m_toCast.scalar(index + 337),
								  m_toCast.scalar(index + 338),
								  m_toCast.scalar(index + 339),
								  m_toCast.scalar(index + 340),
								  m_toCast.scalar(index + 341),
								  m_toCast.scalar(index + 342),
								  m_toCast.scalar(index + 343),
								  m_toCast.scalar(index + 344),
								  m_toCast.scalar(index + 345),
								  m_toCast.scalar(index + 346),
								  m_toCast.scalar(index + 347),
								  m_toCast.scalar(index + 348),
								  m_toCast.scalar(index + 349),
								  m_toCast.scalar(index + 350),
								  m_toCast.scalar(index + 351),
								  m_toCast.scalar(index + 352),
								  m_toCast.scalar(index + 353),
								  m_toCast.scalar(index + 354),
								  m_toCast.scalar(index + 355),
								  m_toCast.scalar(index + 356),
								  m_toCast.scalar(index + 357),
								  m_toCast.scalar(index + 358),
								  m_toCast.scalar(index + 359),
								  m_toCast.scalar(index + 360),
								  m_toCast.scalar(index + 361),
								  m_toCast.scalar(index + 362),
								  m_toCast.scalar(index + 363),
								  m_toCast.scalar(index + 364),
								  m_toCast.scalar(index + 365),
								  m_toCast.scalar(index + 366),
								  m_toCast.scalar(index + 367),
								  m_toCast.scalar(index + 368),
								  m_toCast.scalar(index + 369),
								  m_toCast.scalar(index + 370),
								  m_toCast.scalar(index + 371),
								  m_toCast.scalar(index + 372),
								  m_toCast.scalar(index + 373),
								  m_toCast.scalar(index + 374),
								  m_toCast.scalar(index + 375),
								  m_toCast.scalar(index + 376),
								  m_toCast.scalar(index + 377),
								  m_toCast.scalar(index + 378),
								  m_toCast.scalar(index + 379),
								  m_toCast.scalar(index + 380),
								  m_toCast.scalar(index + 381),
								  m_toCast.scalar(index + 382),
								  m_toCast.scalar(index + 383),
								  m_toCast.scalar(index + 384),
								  m_toCast.scalar(index + 385),
								  m_toCast.scalar(index + 386),
								  m_toCast.scalar(index + 387),
								  m_toCast.scalar(index + 388),
								  m_toCast.scalar(index + 389),
								  m_toCast.scalar(index + 390),
								  m_toCast.scalar(index + 391),
								  m_toCast.scalar(index + 392),
								  m_toCast.scalar(index + 393),
								  m_toCast.scalar(index + 394),
								  m_toCast.scalar(index + 395),
								  m_toCast.scalar(index + 396),
								  m_toCast.scalar(index + 397),
								  m_toCast.scalar(index + 398),
								  m_toCast.scalar(index + 399),
								  m_toCast.scalar(index + 400),
								  m_toCast.scalar(index + 401),
								  m_toCast.scalar(index + 402),
								  m_toCast.scalar(index + 403),
								  m_toCast.scalar(index + 404),
								  m_toCast.scalar(index + 405),
								  m_toCast.scalar(index + 406),
								  m_toCast.scalar(index + 407),
								  m_toCast.scalar(index + 408),
								  m_toCast.scalar(index + 409),
								  m_toCast.scalar(index + 410),
								  m_toCast.scalar(index + 411),
								  m_toCast.scalar(index + 412),
								  m_toCast.scalar(index + 413),
								  m_toCast.scalar(index + 414),
								  m_toCast.scalar(index + 415),
								  m_toCast.scalar(index + 416),
								  m_toCast.scalar(index + 417),
								  m_toCast.scalar(index + 418),
								  m_toCast.scalar(index + 419),
								  m_toCast.scalar(index + 420),
								  m_toCast.scalar(index + 421),
								  m_toCast.scalar(index + 422),
								  m_toCast.scalar(index + 423),
								  m_toCast.scalar(index + 424),
								  m_toCast.scalar(index + 425),
								  m_toCast.scalar(index + 426),
								  m_toCast.scalar(index + 427),
								  m_toCast.scalar(index + 428),
								  m_toCast.scalar(index + 429),
								  m_toCast.scalar(index + 430),
								  m_toCast.scalar(index + 431),
								  m_toCast.scalar(index + 432),
								  m_toCast.scalar(index + 433),
								  m_toCast.scalar(index + 434),
								  m_toCast.scalar(index + 435),
								  m_toCast.scalar(index + 436),
								  m_toCast.scalar(index + 437),
								  m_toCast.scalar(index + 438),
								  m_toCast.scalar(index + 439),
								  m_toCast.scalar(index + 440),
								  m_toCast.scalar(index + 441),
								  m_toCast.scalar(index + 442),
								  m_toCast.scalar(index + 443),
								  m_toCast.scalar(index + 444),
								  m_toCast.scalar(index + 445),
								  m_toCast.scalar(index + 446),
								  m_toCast.scalar(index + 447),
								  m_toCast.scalar(index + 448),
								  m_toCast.scalar(index + 449),
								  m_toCast.scalar(index + 450),
								  m_toCast.scalar(index + 451),
								  m_toCast.scalar(index + 452),
								  m_toCast.scalar(index + 453),
								  m_toCast.scalar(index + 454),
								  m_toCast.scalar(index + 455),
								  m_toCast.scalar(index + 456),
								  m_toCast.scalar(index + 457),
								  m_toCast.scalar(index + 458),
								  m_toCast.scalar(index + 459),
								  m_toCast.scalar(index + 460),
								  m_toCast.scalar(index + 461),
								  m_toCast.scalar(index + 462),
								  m_toCast.scalar(index + 463),
								  m_toCast.scalar(index + 464),
								  m_toCast.scalar(index + 465),
								  m_toCast.scalar(index + 466),
								  m_toCast.scalar(index + 467),
								  m_toCast.scalar(index + 468),
								  m_toCast.scalar(index + 469),
								  m_toCast.scalar(index + 470),
								  m_toCast.scalar(index + 471),
								  m_toCast.scalar(index + 472),
								  m_toCast.scalar(index + 473),
								  m_toCast.scalar(index + 474),
								  m_toCast.scalar(index + 475),
								  m_toCast.scalar(index + 476),
								  m_toCast.scalar(index + 477),
								  m_toCast.scalar(index + 478),
								  m_toCast.scalar(index + 479),
								  m_toCast.scalar(index + 480),
								  m_toCast.scalar(index + 481),
								  m_toCast.scalar(index + 482),
								  m_toCast.scalar(index + 483),
								  m_toCast.scalar(index + 484),
								  m_toCast.scalar(index + 485),
								  m_toCast.scalar(index + 486),
								  m_toCast.scalar(index + 487),
								  m_toCast.scalar(index + 488),
								  m_toCast.scalar(index + 489),
								  m_toCast.scalar(index + 490),
								  m_toCast.scalar(index + 491),
								  m_toCast.scalar(index + 492),
								  m_toCast.scalar(index + 493),
								  m_toCast.scalar(index + 494),
								  m_toCast.scalar(index + 495),
								  m_toCast.scalar(index + 496),
								  m_toCast.scalar(index + 497),
								  m_toCast.scalar(index + 498),
								  m_toCast.scalar(index + 499),
								  m_toCast.scalar(index + 500),
								  m_toCast.scalar(index + 501),
								  m_toCast.scalar(index + 502),
								  m_toCast.scalar(index + 503),
								  m_toCast.scalar(index + 504),
								  m_toCast.scalar(index + 505),
								  m_toCast.scalar(index + 506),
								  m_toCast.scalar(index + 507),
								  m_toCast.scalar(index + 508),
								  m_toCast.scalar(index + 509),
								  m_toCast.scalar(index + 510),
								  m_toCast.scalar(index + 511));
				}

				LR_ASSERT(false, "Unknown Packet Width");
			}

			LR_FORCE_INLINE Scalar scalar(int64_t index) const {
				return Scalar(m_toCast.scalar(index));
			}

		private:
			const InputType &m_toCast;
		};
	} // namespace unary
} // namespace librapid
