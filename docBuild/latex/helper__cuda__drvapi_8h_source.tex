\hypertarget{helper__cuda__drvapi_8h_source}{}\doxysection{helper\+\_\+cuda\+\_\+drvapi.\+h}
\label{helper__cuda__drvapi_8h_source}\index{librapid/include/librapid/cuda/helper\_cuda\_drvapi.h@{librapid/include/librapid/cuda/helper\_cuda\_drvapi.h}}
\mbox{\hyperlink{helper__cuda__drvapi_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00001}00001 \textcolor{comment}{/* Copyright (c) 2019, NVIDIA CORPORATION. All rights reserved.}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00002}00002 \textcolor{comment}{ *}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00003}00003 \textcolor{comment}{ * Redistribution and use in source and binary forms, with or without}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00004}00004 \textcolor{comment}{ * modification, are permitted provided that the following conditions}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00005}00005 \textcolor{comment}{ * are met:}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00006}00006 \textcolor{comment}{ *  * Redistributions of source code must retain the above copyright}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00007}00007 \textcolor{comment}{ *    notice, this list of conditions and the following disclaimer.}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00008}00008 \textcolor{comment}{ *  * Redistributions in binary form must reproduce the above copyright}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00009}00009 \textcolor{comment}{ *    notice, this list of conditions and the following disclaimer in the}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00010}00010 \textcolor{comment}{ *    documentation and/or other materials provided with the distribution.}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00011}00011 \textcolor{comment}{ *  * Neither the name of NVIDIA CORPORATION nor the names of its}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00012}00012 \textcolor{comment}{ *    contributors may be used to endorse or promote products derived}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00013}00013 \textcolor{comment}{ *    from this software without specific prior written permission.}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00014}00014 \textcolor{comment}{ *}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00015}00015 \textcolor{comment}{ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00016}00016 \textcolor{comment}{ * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00017}00017 \textcolor{comment}{ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00018}00018 \textcolor{comment}{ * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00019}00019 \textcolor{comment}{ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00020}00020 \textcolor{comment}{ * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00021}00021 \textcolor{comment}{ * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00022}00022 \textcolor{comment}{ * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00023}00023 \textcolor{comment}{ * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00024}00024 \textcolor{comment}{ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00025}00025 \textcolor{comment}{ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00026}00026 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00028}00028 \textcolor{comment}{// Helper functions for CUDA Driver API error handling (make sure that CUDA\_H is}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00029}00029 \textcolor{comment}{// included in your projects)}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00030}00030 \textcolor{preprocessor}{\#ifndef COMMON\_HELPER\_CUDA\_DRVAPI\_H\_}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00031}00031 \textcolor{preprocessor}{\#define COMMON\_HELPER\_CUDA\_DRVAPI\_H\_}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00032}00032 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00033}00033 \textcolor{preprocessor}{\#include <cstring>}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00034}00034 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{helper__string_8h}{helper\_string.h}}"{}}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00035}00035 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00036}00036 \textcolor{preprocessor}{\#include <sstream>}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00037}00037 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00038}00038 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00039}00039 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00040}00040 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00041}00041 \textcolor{preprocessor}{\#ifndef MAX}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00042}\mbox{\hyperlink{helper__cuda__drvapi_8h_afa99ec4acc4ecb2dc3c2d05da15d0e3f}{00042}} \textcolor{preprocessor}{\#   define MAX(a, b) (a > b ? a : b)}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00043}00043 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00044}00044 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00045}00045 \textcolor{preprocessor}{\#ifndef COMMON\_HELPER\_CUDA\_H\_}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00046}00046 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00047}\mbox{\hyperlink{helper__cuda__drvapi_8h_afe9ccb8dde63e20ae24933aa14b90c0e}{00047}} \textcolor{keyword}{inline} \textcolor{keywordtype}{int} \mbox{\hyperlink{helper__cuda__drvapi_8h_afe9ccb8dde63e20ae24933aa14b90c0e}{ftoi}}(\textcolor{keywordtype}{float} value) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00048}00048     \textcolor{keywordflow}{return} (value >= 0 ? \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(value + 0.5) : \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(value -\/ 0.5));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00049}00049 \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00050}00050 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00051}00051 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00052}00052 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00053}00053 \textcolor{preprocessor}{\#ifndef EXIT\_WAIVED}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00054}00054 \textcolor{preprocessor}{\#   define EXIT\_WAIVED 2}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00055}00055 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00056}00056 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00058}00058 \textcolor{comment}{// These are CUDA Helper functions}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00059}00059 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00060}00060 \textcolor{comment}{// add a level of protection to the CUDA SDK samples, let's force samples to}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00061}00061 \textcolor{comment}{// explicitly include CUDA.H}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00062}00062 \textcolor{preprocessor}{\#ifdef \_\_cuda\_cuda\_h\_\_}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00063}00063 \textcolor{comment}{// This will output the proper CUDA error strings in the event that a CUDA host}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00064}00064 \textcolor{comment}{// call returns an error}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00065}00065 \textcolor{preprocessor}{\#   ifndef checkCudaErrors}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00066}00066 \textcolor{preprocessor}{\#       define checkCudaErrors(err) \_\_checkCudaErrors(err, \_\_FILE\_\_, \_\_LINE\_\_)}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00067}00067 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00068}00068 \textcolor{comment}{// These are the inline versions for all of the SDK helper functions}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00069}00069 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \_\_checkCudaErrors(CUresult err, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *file, \textcolor{keyword}{const} \textcolor{keywordtype}{int} line) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00070}00070     \textcolor{keywordflow}{if} (CUDA\_SUCCESS != err) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00071}00071         \textcolor{keyword}{const} \textcolor{keywordtype}{char} *errorStr = NULL;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00072}00072         cuGetErrorString(err, \&errorStr);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00073}00073         fprintf(stderr,}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00074}00074                 \textcolor{stringliteral}{"{}checkCudaErrors() Driver API error = \%04d \(\backslash\)"{}\%s\(\backslash\)"{} from file <\%s>, "{}}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00075}00075                 \textcolor{stringliteral}{"{}line \%i.\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00076}00076                 err,}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00077}00077                 errorStr,}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00078}00078                 file,}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00079}00079                 line);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00080}00080         exit(EXIT\_FAILURE);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00081}00081     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00082}00082 \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00083}00083 \textcolor{preprocessor}{\#   endif}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00084}00084 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00085}00085 \textcolor{comment}{// This function wraps the CUDA Driver API into a template function}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00086}00086 \textcolor{keyword}{template}<\textcolor{keyword}{class} T>}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00087}00087 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} getCudaAttribute(T *attribute, CUdevice\_attribute device\_attribute, \textcolor{keywordtype}{int} device) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00088}00088     checkCudaErrors(cuDeviceGetAttribute(attribute, device\_attribute, device));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00089}00089 \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00090}00090 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00091}00091 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00092}00092 \textcolor{comment}{// Beginning of GPU Architecture definitions}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00093}\mbox{\hyperlink{helper__cuda__drvapi_8h_afc0adc5e6b1d11343ab0eb58db0e3e39}{00093}} \textcolor{keyword}{inline} \textcolor{keywordtype}{int} \mbox{\hyperlink{helper__cuda__drvapi_8h_afc0adc5e6b1d11343ab0eb58db0e3e39}{\_ConvertSMVer2CoresDRV}}(\textcolor{keywordtype}{int} major, \textcolor{keywordtype}{int} minor) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00094}00094     \textcolor{comment}{// Defines for GPU Architecture types (using the SM version to determine the}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00095}00095     \textcolor{comment}{// \# of cores per SM}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00096}00096     \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00097}00097         \textcolor{keywordtype}{int} SM; \textcolor{comment}{// 0xMm (hexidecimal notation), M = SM Major version, and m = SM}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00098}00098         \textcolor{comment}{// minor version}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00099}00099         \textcolor{keywordtype}{int} Cores;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00100}00100     \} sSMtoCores;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00101}00101 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00102}00102     sSMtoCores nGpuArchCoresPerSM[] = \{\{0x30, 192\},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00103}00103                                        \{0x32, 192\},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00104}00104                                        \{0x35, 192\},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00105}00105                                        \{0x37, 192\},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00106}00106                                        \{0x50, 128\},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00107}00107                                        \{0x52, 128\},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00108}00108                                        \{0x53, 128\},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00109}00109                                        \{0x60, 64\},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00110}00110                                        \{0x61, 128\},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00111}00111                                        \{0x62, 128\},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00112}00112                                        \{0x70, 64\},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00113}00113                                        \{0x72, 64\},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00114}00114                                        \{0x75, 64\},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00115}00115                                        \{0x80, 64\},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00116}00116                                        \{0x86, 128\},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00117}00117                                        \{-\/1, -\/1\}\};}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00118}00118 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00119}00119     \textcolor{keywordtype}{int} index = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00120}00120 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00121}00121     \textcolor{keywordflow}{while} (nGpuArchCoresPerSM[index].SM != -\/1) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00122}00122         \textcolor{keywordflow}{if} (nGpuArchCoresPerSM[index].SM == ((major << 4) + minor)) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00123}00123             \textcolor{keywordflow}{return} nGpuArchCoresPerSM[index].Cores;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00124}00124         \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00125}00125 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00126}00126         index++;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00127}00127     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00128}00128 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00129}00129     \textcolor{comment}{// If we don't find the values, we default use the previous one to run}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00130}00130     \textcolor{comment}{// properly}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00131}00131     printf(\textcolor{stringliteral}{"{}MapSMtoCores for SM \%d.\%d is undefined.  Default to use \%d Cores/SM\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00132}00132            major,}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00133}00133            minor,}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00134}00134            nGpuArchCoresPerSM[index -\/ 1].Cores);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00135}00135     \textcolor{keywordflow}{return} nGpuArchCoresPerSM[index -\/ 1].Cores;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00136}00136 \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00137}00137 \textcolor{comment}{// end of GPU Architecture definitions}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00138}00138 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00139}00139 \textcolor{preprocessor}{\#ifdef \_\_cuda\_cuda\_h\_\_}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00140}00140 \textcolor{comment}{// General GPU Device CUDA Initialization}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00141}00141 \textcolor{keyword}{inline} \textcolor{keywordtype}{int} gpuDeviceInitDRV(\textcolor{keywordtype}{int} ARGC, \textcolor{keyword}{const} \textcolor{keywordtype}{char} **ARGV) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00142}00142     \textcolor{keywordtype}{int} cuDevice    = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00143}00143     \textcolor{keywordtype}{int} deviceCount = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00144}00144     checkCudaErrors(cuInit(0));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00145}00145 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00146}00146     checkCudaErrors(cuDeviceGetCount(\&deviceCount));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00147}00147 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00148}00148     \textcolor{keywordflow}{if} (deviceCount == 0) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00149}00149         fprintf(stderr, \textcolor{stringliteral}{"{}cudaDeviceInit error: no devices supporting CUDA\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00150}00150         exit(EXIT\_FAILURE);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00151}00151     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00152}00152 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00153}00153     \textcolor{keywordtype}{int} dev = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00154}00154     dev     = \mbox{\hyperlink{helper__string_8h_ade9cb99a49aabcdf5ddcc8d276174576}{getCmdLineArgumentInt}}(ARGC, (\textcolor{keyword}{const} \textcolor{keywordtype}{char} **)ARGV, \textcolor{stringliteral}{"{}device="{}});}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00155}00155 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00156}00156     \textcolor{keywordflow}{if} (dev < 0) \{ dev = 0; \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00157}00157 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00158}00158     \textcolor{keywordflow}{if} (dev > deviceCount -\/ 1) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00159}00159         fprintf(stderr, \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00160}00160         fprintf(stderr, \textcolor{stringliteral}{"{}>> \%d CUDA capable GPU device(s) detected. <<\(\backslash\)n"{}}, deviceCount);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00161}00161         fprintf(stderr, \textcolor{stringliteral}{"{}>> cudaDeviceInit (-\/device=\%d) is not a valid GPU device. <<\(\backslash\)n"{}}, dev);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00162}00162         fprintf(stderr, \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00163}00163         \textcolor{keywordflow}{return} -\/dev;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00164}00164     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00165}00165 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00166}00166     checkCudaErrors(cuDeviceGet(\&cuDevice, dev));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00167}00167     \textcolor{keywordtype}{char} name[100];}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00168}00168     checkCudaErrors(cuDeviceGetName(name, 100, cuDevice));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00169}00169 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00170}00170     \textcolor{keywordtype}{int} computeMode;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00171}00171     getCudaAttribute<int>(\&computeMode, CU\_DEVICE\_ATTRIBUTE\_COMPUTE\_MODE, dev);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00172}00172 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00173}00173     \textcolor{keywordflow}{if} (computeMode == CU\_COMPUTEMODE\_PROHIBITED) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00174}00174         fprintf(stderr,}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00175}00175                 \textcolor{stringliteral}{"{}Error: device is running in <CU\_COMPUTEMODE\_PROHIBITED>, no "{}}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00176}00176                 \textcolor{stringliteral}{"{}threads can use this CUDA Device.\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00177}00177         \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00178}00178     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00179}00179 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00180}00180     \textcolor{keywordflow}{if} (\mbox{\hyperlink{helper__string_8h_ac4941870cb5a1c286453eccb73e2e2a6}{checkCmdLineFlag}}(ARGC, (\textcolor{keyword}{const} \textcolor{keywordtype}{char} **)ARGV, \textcolor{stringliteral}{"{}quiet"{}}) == \textcolor{keyword}{false}) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00181}00181         printf(\textcolor{stringliteral}{"{}gpuDeviceInitDRV() Using CUDA Device [\%d]: \%s\(\backslash\)n"{}}, dev, name);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00182}00182     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00183}00183 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00184}00184     \textcolor{keywordflow}{return} dev;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00185}00185 \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00186}00186 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00187}00187 \textcolor{comment}{// This function returns the best GPU based on performance}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00188}00188 \textcolor{keyword}{inline} \textcolor{keywordtype}{int} gpuGetMaxGflopsDeviceIdDRV() \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00189}00189     CUdevice current\_device             = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00190}00190     CUdevice max\_perf\_device            = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00191}00191     \textcolor{keywordtype}{int} device\_count                    = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00192}00192     \textcolor{keywordtype}{int} sm\_per\_multiproc                = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00193}00193     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} max\_compute\_perf = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00194}00194     \textcolor{keywordtype}{int} major                           = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00195}00195     \textcolor{keywordtype}{int} minor                           = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00196}00196     \textcolor{keywordtype}{int} multiProcessorCount;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00197}00197     \textcolor{keywordtype}{int} clockRate;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00198}00198     \textcolor{keywordtype}{int} devices\_prohibited = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00199}00199 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00200}00200     cuInit(0);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00201}00201     checkCudaErrors(cuDeviceGetCount(\&device\_count));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00202}00202 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00203}00203     \textcolor{keywordflow}{if} (device\_count == 0) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00204}00204         fprintf(stderr, \textcolor{stringliteral}{"{}gpuGetMaxGflopsDeviceIdDRV error: no devices supporting CUDA\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00205}00205         exit(EXIT\_FAILURE);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00206}00206     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00207}00207 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00208}00208     \textcolor{comment}{// Find the best CUDA capable GPU device}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00209}00209     current\_device = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00210}00210 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00211}00211     \textcolor{keywordflow}{while} (current\_device < device\_count) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00212}00212         checkCudaErrors(cuDeviceGetAttribute(}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00213}00213           \&multiProcessorCount, CU\_DEVICE\_ATTRIBUTE\_MULTIPROCESSOR\_COUNT, current\_device));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00214}00214         checkCudaErrors(}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00215}00215           cuDeviceGetAttribute(\&clockRate, CU\_DEVICE\_ATTRIBUTE\_CLOCK\_RATE, current\_device));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00216}00216         checkCudaErrors(cuDeviceGetAttribute(}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00217}00217           \&major, CU\_DEVICE\_ATTRIBUTE\_COMPUTE\_CAPABILITY\_MAJOR, current\_device));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00218}00218         checkCudaErrors(cuDeviceGetAttribute(}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00219}00219           \&minor, CU\_DEVICE\_ATTRIBUTE\_COMPUTE\_CAPABILITY\_MINOR, current\_device));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00220}00220 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00221}00221         \textcolor{keywordtype}{int} computeMode;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00222}00222         getCudaAttribute<int>(\&computeMode, CU\_DEVICE\_ATTRIBUTE\_COMPUTE\_MODE, current\_device);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00223}00223 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00224}00224         \textcolor{keywordflow}{if} (computeMode != CU\_COMPUTEMODE\_PROHIBITED) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00225}00225             \textcolor{keywordflow}{if} (major == 9999 \&\& minor == 9999) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00226}00226                 sm\_per\_multiproc = 1;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00227}00227             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00228}00228                 sm\_per\_multiproc = \mbox{\hyperlink{helper__cuda__drvapi_8h_afc0adc5e6b1d11343ab0eb58db0e3e39}{\_ConvertSMVer2CoresDRV}}(major, minor);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00229}00229             \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00230}00230 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00231}00231             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} compute\_perf =}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00232}00232               (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} long)(multiProcessorCount * sm\_per\_multiproc * clockRate);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00233}00233 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00234}00234             \textcolor{keywordflow}{if} (compute\_perf > max\_compute\_perf) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00235}00235                 max\_compute\_perf = compute\_perf;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00236}00236                 max\_perf\_device  = current\_device;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00237}00237             \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00238}00238         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00239}00239             devices\_prohibited++;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00240}00240         \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00241}00241 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00242}00242         ++current\_device;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00243}00243     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00244}00244 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00245}00245     \textcolor{keywordflow}{if} (devices\_prohibited == device\_count) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00246}00246         fprintf(stderr,}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00247}00247                 \textcolor{stringliteral}{"{}gpuGetMaxGflopsDeviceIdDRV error: all devices have compute mode "{}}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00248}00248                 \textcolor{stringliteral}{"{}prohibited.\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00249}00249         exit(EXIT\_FAILURE);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00250}00250     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00251}00251 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00252}00252     \textcolor{keywordflow}{return} max\_perf\_device;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00253}00253 \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00254}00254 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00255}00255 \textcolor{comment}{// General initialization call to pick the best CUDA Device}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00256}00256 \textcolor{keyword}{inline} CUdevice findCudaDeviceDRV(\textcolor{keywordtype}{int} argc, \textcolor{keyword}{const} \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00257}00257     CUdevice cuDevice;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00258}00258     \textcolor{keywordtype}{int} devID = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00259}00259 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00260}00260     \textcolor{comment}{// If the command-\/line has a device number specified, use it}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00261}00261     \textcolor{keywordflow}{if} (\mbox{\hyperlink{helper__string_8h_ac4941870cb5a1c286453eccb73e2e2a6}{checkCmdLineFlag}}(argc, (\textcolor{keyword}{const} \textcolor{keywordtype}{char} **)argv, \textcolor{stringliteral}{"{}device"{}})) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00262}00262         devID = gpuDeviceInitDRV(argc, argv);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00263}00263 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00264}00264         \textcolor{keywordflow}{if} (devID < 0) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00265}00265             printf(\textcolor{stringliteral}{"{}exiting...\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00266}00266             exit(EXIT\_SUCCESS);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00267}00267         \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00268}00268     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00269}00269         \textcolor{comment}{// Otherwise pick the device with highest Gflops/s}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00270}00270         \textcolor{keywordtype}{char} name[100];}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00271}00271         devID = gpuGetMaxGflopsDeviceIdDRV();}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00272}00272         checkCudaErrors(cuDeviceGet(\&cuDevice, devID));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00273}00273         cuDeviceGetName(name, 100, cuDevice);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00274}00274         printf(\textcolor{stringliteral}{"{}> Using CUDA Device [\%d]: \%s\(\backslash\)n"{}}, devID, name);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00275}00275     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00276}00276 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00277}00277     cuDeviceGet(\&cuDevice, devID);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00278}00278 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00279}00279     \textcolor{keywordflow}{return} cuDevice;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00280}00280 \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00281}00281 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00282}00282 \textcolor{keyword}{inline} CUdevice findIntegratedGPUDrv() \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00283}00283     CUdevice current\_device = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00284}00284     \textcolor{keywordtype}{int} device\_count        = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00285}00285     \textcolor{keywordtype}{int} devices\_prohibited  = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00286}00286     \textcolor{keywordtype}{int} isIntegrated;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00287}00287 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00288}00288     cuInit(0);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00289}00289     checkCudaErrors(cuDeviceGetCount(\&device\_count));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00290}00290 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00291}00291     \textcolor{keywordflow}{if} (device\_count == 0) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00292}00292         fprintf(stderr, \textcolor{stringliteral}{"{}CUDA error: no devices supporting CUDA.\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00293}00293         exit(EXIT\_FAILURE);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00294}00294     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00295}00295 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00296}00296     \textcolor{comment}{// Find the integrated GPU which is compute capable}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00297}00297     \textcolor{keywordflow}{while} (current\_device < device\_count) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00298}00298         \textcolor{keywordtype}{int} computeMode = -\/1;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00299}00299         checkCudaErrors(}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00300}00300           cuDeviceGetAttribute(\&isIntegrated, CU\_DEVICE\_ATTRIBUTE\_INTEGRATED, current\_device));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00301}00301         checkCudaErrors(}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00302}00302           cuDeviceGetAttribute(\&computeMode, CU\_DEVICE\_ATTRIBUTE\_COMPUTE\_MODE, current\_device));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00303}00303 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00304}00304         \textcolor{comment}{// If GPU is integrated and is not running on Compute Mode prohibited}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00305}00305         \textcolor{comment}{// use that}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00306}00306         \textcolor{keywordflow}{if} (isIntegrated \&\& (computeMode != CU\_COMPUTEMODE\_PROHIBITED)) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00307}00307             \textcolor{keywordtype}{int} major = 0, minor = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00308}00308             \textcolor{keywordtype}{char} deviceName[256];}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00309}00309             checkCudaErrors(cuDeviceGetAttribute(}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00310}00310               \&major, CU\_DEVICE\_ATTRIBUTE\_COMPUTE\_CAPABILITY\_MAJOR, current\_device));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00311}00311             checkCudaErrors(cuDeviceGetAttribute(}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00312}00312               \&minor, CU\_DEVICE\_ATTRIBUTE\_COMPUTE\_CAPABILITY\_MINOR, current\_device));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00313}00313             checkCudaErrors(cuDeviceGetName(deviceName, 256, current\_device));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00314}00314             printf(\textcolor{stringliteral}{"{}GPU Device \%d: \(\backslash\)"{}\%s\(\backslash\)"{} with compute capability \%d.\%d\(\backslash\)n\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00315}00315                    current\_device,}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00316}00316                    deviceName,}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00317}00317                    major,}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00318}00318                    minor);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00319}00319 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00320}00320             \textcolor{keywordflow}{return} current\_device;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00321}00321         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00322}00322             devices\_prohibited++;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00323}00323         \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00324}00324 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00325}00325         current\_device++;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00326}00326     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00327}00327 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00328}00328     \textcolor{keywordflow}{if} (devices\_prohibited == device\_count) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00329}00329         fprintf(stderr, \textcolor{stringliteral}{"{}CUDA error: No Integrated CUDA capable GPU found.\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00330}00330         exit(EXIT\_FAILURE);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00331}00331     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00332}00332 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00333}00333     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00334}00334 \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00335}00335 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00336}00336 \textcolor{comment}{// General check for CUDA GPU SM Capabilities}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00337}00337 \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} checkCudaCapabilitiesDRV(\textcolor{keywordtype}{int} major\_version, \textcolor{keywordtype}{int} minor\_version, \textcolor{keywordtype}{int} devID) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00338}00338     CUdevice cuDevice;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00339}00339     \textcolor{keywordtype}{char} name[256];}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00340}00340     \textcolor{keywordtype}{int} major = 0, minor = 0;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00341}00341 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00342}00342     checkCudaErrors(cuDeviceGet(\&cuDevice, devID));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00343}00343     checkCudaErrors(cuDeviceGetName(name, 100, cuDevice));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00344}00344     checkCudaErrors(}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00345}00345       cuDeviceGetAttribute(\&major, CU\_DEVICE\_ATTRIBUTE\_COMPUTE\_CAPABILITY\_MAJOR, cuDevice));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00346}00346     checkCudaErrors(}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00347}00347       cuDeviceGetAttribute(\&minor, CU\_DEVICE\_ATTRIBUTE\_COMPUTE\_CAPABILITY\_MINOR, cuDevice));}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00348}00348 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00349}00349     \textcolor{keywordflow}{if} ((major > major\_version) || (major == major\_version \&\& minor >= minor\_version)) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00350}00350         printf(\textcolor{stringliteral}{"{}> Device \%d: <\%16s >, Compute SM \%d.\%d detected\(\backslash\)n"{}}, devID, name, major, minor);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00351}00351         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00352}00352     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00353}00353         printf(}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00354}00354           \textcolor{stringliteral}{"{}No GPU device was found that can support CUDA compute capability "{}}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00355}00355           \textcolor{stringliteral}{"{}\%d.\%d.\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00356}00356           major\_version,}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00357}00357           minor\_version);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00358}00358         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00359}00359     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00360}00360 \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00361}00361 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00362}00362 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00363}\mbox{\hyperlink{helper__cuda__drvapi_8h_ad663d929d9666c32c54f9867e641a9e6}{00363}} \textcolor{keywordtype}{bool} \textcolor{keyword}{inline} \mbox{\hyperlink{helper__cuda__drvapi_8h_ad663d929d9666c32c54f9867e641a9e6}{findFatbinPath}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *module\_file, std::string \&module\_path, \textcolor{keywordtype}{char} **argv,}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00364}00364                            std::ostringstream \&ostrm) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00365}00365     \textcolor{keywordtype}{char} *actual\_path = \mbox{\hyperlink{helper__string_8h_a2f7f20ba2a009934e429a70f5e8e99ef}{sdkFindFilePath}}(module\_file, argv[0]);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00366}00366 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00367}00367     \textcolor{keywordflow}{if} (actual\_path) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00368}00368         module\_path = actual\_path;}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00369}00369     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00370}00370         printf(\textcolor{stringliteral}{"{}> findModulePath file not found: <\%s> \(\backslash\)n"{}}, module\_file);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00371}00371         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00372}00372     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00373}00373 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00374}00374     \textcolor{keywordflow}{if} (module\_path.empty()) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00375}00375         printf(\textcolor{stringliteral}{"{}> findModulePath could not find file: <\%s> \(\backslash\)n"{}}, module\_file);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00376}00376         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00377}00377     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00378}00378         printf(\textcolor{stringliteral}{"{}> findModulePath found file at <\%s>\(\backslash\)n"{}}, module\_path.c\_str());}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00379}00379         \textcolor{keywordflow}{if} (module\_path.rfind(\textcolor{stringliteral}{"{}fatbin"{}}) != std::string::npos) \{}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00380}00380             std::ifstream fileIn(module\_path.c\_str(), std::ios::binary);}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00381}00381             ostrm << fileIn.rdbuf();}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00382}00382             fileIn.close();}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00383}00383         \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00384}00384         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00385}00385     \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00386}00386 \}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00387}00387 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00388}00388 \textcolor{comment}{// end of CUDA Helper Functions}}
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00389}00389 }
\DoxyCodeLine{\Hypertarget{helper__cuda__drvapi_8h_source_l00390}00390 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// COMMON\_HELPER\_CUDA\_DRVAPI\_H\_}}

\end{DoxyCode}
