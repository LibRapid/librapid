\hypertarget{helper__cuda_8h_source}{}\doxysection{helper\+\_\+cuda.\+h}
\label{helper__cuda_8h_source}\index{librapid/include/librapid/cuda/helper\_cuda.h@{librapid/include/librapid/cuda/helper\_cuda.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/* Copyright (c) 2019, NVIDIA CORPORATION. All rights reserved.}}
\DoxyCodeLine{2 \textcolor{comment}{ *}}
\DoxyCodeLine{3 \textcolor{comment}{ * Redistribution and use in source and binary forms, with or without}}
\DoxyCodeLine{4 \textcolor{comment}{ * modification, are permitted provided that the following conditions}}
\DoxyCodeLine{5 \textcolor{comment}{ * are met:}}
\DoxyCodeLine{6 \textcolor{comment}{ *  * Redistributions of source code must retain the above copyright}}
\DoxyCodeLine{7 \textcolor{comment}{ *    notice, this list of conditions and the following disclaimer.}}
\DoxyCodeLine{8 \textcolor{comment}{ *  * Redistributions in binary form must reproduce the above copyright}}
\DoxyCodeLine{9 \textcolor{comment}{ *    notice, this list of conditions and the following disclaimer in the}}
\DoxyCodeLine{10 \textcolor{comment}{ *    documentation and/or other materials provided with the distribution.}}
\DoxyCodeLine{11 \textcolor{comment}{ *  * Neither the name of NVIDIA CORPORATION nor the names of its}}
\DoxyCodeLine{12 \textcolor{comment}{ *    contributors may be used to endorse or promote products derived}}
\DoxyCodeLine{13 \textcolor{comment}{ *    from this software without specific prior written permission.}}
\DoxyCodeLine{14 \textcolor{comment}{ *}}
\DoxyCodeLine{15 \textcolor{comment}{ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY}}
\DoxyCodeLine{16 \textcolor{comment}{ * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE}}
\DoxyCodeLine{17 \textcolor{comment}{ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR}}
\DoxyCodeLine{18 \textcolor{comment}{ * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR}}
\DoxyCodeLine{19 \textcolor{comment}{ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,}}
\DoxyCodeLine{20 \textcolor{comment}{ * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,}}
\DoxyCodeLine{21 \textcolor{comment}{ * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR}}
\DoxyCodeLine{22 \textcolor{comment}{ * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY}}
\DoxyCodeLine{23 \textcolor{comment}{ * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT}}
\DoxyCodeLine{24 \textcolor{comment}{ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE}}
\DoxyCodeLine{25 \textcolor{comment}{ * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.}}
\DoxyCodeLine{26 \textcolor{comment}{ */}}
\DoxyCodeLine{27 }
\DoxyCodeLine{29 \textcolor{comment}{// These are CUDA Helper functions for initialization and error checking}}
\DoxyCodeLine{30 }
\DoxyCodeLine{31 \textcolor{preprocessor}{\#ifndef COMMON\_HELPER\_CUDA\_H\_}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#define COMMON\_HELPER\_CUDA\_H\_}}
\DoxyCodeLine{33 }
\DoxyCodeLine{34 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{35 }
\DoxyCodeLine{36 \textcolor{preprocessor}{\#include "{}helper\_string.h"{}}}
\DoxyCodeLine{37 \textcolor{preprocessor}{\#include <stdint.h>}}
\DoxyCodeLine{38 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{39 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{40 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{41 }
\DoxyCodeLine{42 \textcolor{preprocessor}{\#ifndef EXIT\_WAIVED}}
\DoxyCodeLine{43 \textcolor{preprocessor}{\#   define EXIT\_WAIVED 2}}
\DoxyCodeLine{44 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{45 }
\DoxyCodeLine{46 \textcolor{comment}{// Note, it is required that your SDK sample to include the proper header}}
\DoxyCodeLine{47 \textcolor{comment}{// files, please refer the CUDA examples for examples of the needed CUDA}}
\DoxyCodeLine{48 \textcolor{comment}{// headers, which may change depending on which CUDA functions are used.}}
\DoxyCodeLine{49 }
\DoxyCodeLine{50 \textcolor{comment}{// CUDA Runtime error messages}}
\DoxyCodeLine{51 \textcolor{preprocessor}{\#ifdef \_\_DRIVER\_TYPES\_H\_\_}}
\DoxyCodeLine{52 \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\_cudaGetErrorEnum(cudaError\_t error);}
\DoxyCodeLine{53 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{54 }
\DoxyCodeLine{55 \textcolor{preprocessor}{\#ifdef CUDA\_DRIVER\_API}}
\DoxyCodeLine{56 \textcolor{comment}{// CUDA Driver API errors}}
\DoxyCodeLine{57 \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\_cudaGetErrorEnum(CUresult error);}
\DoxyCodeLine{58 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{59 }
\DoxyCodeLine{60 \textcolor{preprocessor}{\#ifdef CUBLAS\_API\_H\_}}
\DoxyCodeLine{61 \textcolor{comment}{// cuBLAS API errors}}
\DoxyCodeLine{62 \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\_cudaGetErrorEnum(cublasStatus\_t error);}
\DoxyCodeLine{63 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{64 }
\DoxyCodeLine{65 \textcolor{preprocessor}{\#ifdef \_CUFFT\_H\_}}
\DoxyCodeLine{66 \textcolor{comment}{// cuFFT API errors}}
\DoxyCodeLine{67 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\_cudaGetErrorEnum(cufftResult error);}
\DoxyCodeLine{68 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{69 }
\DoxyCodeLine{70 \textcolor{preprocessor}{\#ifdef CUSPARSEAPI}}
\DoxyCodeLine{71 \textcolor{comment}{// cuSPARSE API errors}}
\DoxyCodeLine{72 \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\_cudaGetErrorEnum(cusparseStatus\_t error);}
\DoxyCodeLine{73 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{74 }
\DoxyCodeLine{75 \textcolor{preprocessor}{\#ifdef CUSOLVER\_COMMON\_H\_}}
\DoxyCodeLine{76 \textcolor{comment}{// cuSOLVER API errors}}
\DoxyCodeLine{77 \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\_cudaGetErrorEnum(cusolverStatus\_t error);}
\DoxyCodeLine{78 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{79 }
\DoxyCodeLine{80 \textcolor{preprocessor}{\#ifdef CURAND\_H\_}}
\DoxyCodeLine{81 \textcolor{comment}{// cuRAND API errors}}
\DoxyCodeLine{82 \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\_cudaGetErrorEnum(curandStatus\_t error);}
\DoxyCodeLine{83 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{84 }
\DoxyCodeLine{85 \textcolor{preprocessor}{\#ifdef NVJPEGAPI}}
\DoxyCodeLine{86 \textcolor{comment}{// nvJPEG API errors}}
\DoxyCodeLine{87 \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\_cudaGetErrorEnum(nvjpegStatus\_t error);}
\DoxyCodeLine{88 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{89 }
\DoxyCodeLine{90 \textcolor{preprocessor}{\#ifdef NV\_NPPIDEFS\_H}}
\DoxyCodeLine{91 \textcolor{comment}{// NPP API errors}}
\DoxyCodeLine{92 \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\_cudaGetErrorEnum(NppStatus error);}
\DoxyCodeLine{93 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{94 }
\DoxyCodeLine{95 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>}
\DoxyCodeLine{96 \textcolor{keywordtype}{void} check(T result, \textcolor{keywordtype}{char} \textcolor{keyword}{const} *\textcolor{keyword}{const} func, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\textcolor{keyword}{const} file, \textcolor{keywordtype}{int} \textcolor{keyword}{const} line) \{}
\DoxyCodeLine{97     \textcolor{keywordflow}{if} (result) \{}
\DoxyCodeLine{98         fprintf(stderr,}
\DoxyCodeLine{99                 \textcolor{stringliteral}{"{}CUDA error at \%s:\%d code=\%d(\%s) \(\backslash\)"{}\%s\(\backslash\)"{} \(\backslash\)n"{}},}
\DoxyCodeLine{100                 file,}
\DoxyCodeLine{101                 line,}
\DoxyCodeLine{102                 \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}(result),}
\DoxyCodeLine{103                 \_cudaGetErrorEnum(result),}
\DoxyCodeLine{104                 func);}
\DoxyCodeLine{105         exit(EXIT\_FAILURE);}
\DoxyCodeLine{106     \}}
\DoxyCodeLine{107 \}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109 \textcolor{preprocessor}{\#ifdef \_\_DRIVER\_TYPES\_H\_\_}}
\DoxyCodeLine{110 \textcolor{comment}{// This will output the proper CUDA error strings in the event}}
\DoxyCodeLine{111 \textcolor{comment}{// that a CUDA host call returns an error}}
\DoxyCodeLine{112 \textcolor{preprocessor}{\#   define checkCudaErrors(val) check((val), \#    val, \_\_FILE\_\_, \_\_LINE\_\_)}}
\DoxyCodeLine{113 }
\DoxyCodeLine{114 \textcolor{comment}{// This will output the proper error string when calling cudaGetLastError}}
\DoxyCodeLine{115 \textcolor{preprocessor}{\#   define getLastCudaError(msg) \_\_getLastCudaError(msg, \_\_FILE\_\_, \_\_LINE\_\_)}}
\DoxyCodeLine{116 }
\DoxyCodeLine{117 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \_\_getLastCudaError(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *errorMessage, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *file, \textcolor{keyword}{const} \textcolor{keywordtype}{int} line) \{}
\DoxyCodeLine{118     cudaError\_t err = cudaGetLastError();}
\DoxyCodeLine{119 }
\DoxyCodeLine{120     \textcolor{keywordflow}{if} (cudaSuccess != err) \{}
\DoxyCodeLine{121         fprintf(stderr,}
\DoxyCodeLine{122                 \textcolor{stringliteral}{"{}\%s(\%i) : getLastCudaError() CUDA error :"{}}}
\DoxyCodeLine{123                 \textcolor{stringliteral}{"{} \%s : (\%d) \%s.\(\backslash\)n"{}},}
\DoxyCodeLine{124                 file,}
\DoxyCodeLine{125                 line,}
\DoxyCodeLine{126                 errorMessage,}
\DoxyCodeLine{127                 \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(err),}
\DoxyCodeLine{128                 cudaGetErrorString(err));}
\DoxyCodeLine{129         exit(EXIT\_FAILURE);}
\DoxyCodeLine{130     \}}
\DoxyCodeLine{131 \}}
\DoxyCodeLine{132 }
\DoxyCodeLine{133 \textcolor{comment}{// This will only print the proper error string when calling cudaGetLastError}}
\DoxyCodeLine{134 \textcolor{comment}{// but not exit program incase error detected.}}
\DoxyCodeLine{135 \textcolor{preprocessor}{\#   define printLastCudaError(msg) \_\_printLastCudaError(msg, \_\_FILE\_\_, \_\_LINE\_\_)}}
\DoxyCodeLine{136 }
\DoxyCodeLine{137 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \_\_printLastCudaError(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *errorMessage, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *file, \textcolor{keyword}{const} \textcolor{keywordtype}{int} line) \{}
\DoxyCodeLine{138     cudaError\_t err = cudaGetLastError();}
\DoxyCodeLine{139 }
\DoxyCodeLine{140     \textcolor{keywordflow}{if} (cudaSuccess != err) \{}
\DoxyCodeLine{141         fprintf(stderr,}
\DoxyCodeLine{142                 \textcolor{stringliteral}{"{}\%s(\%i) : getLastCudaError() CUDA error :"{}}}
\DoxyCodeLine{143                 \textcolor{stringliteral}{"{} \%s : (\%d) \%s.\(\backslash\)n"{}},}
\DoxyCodeLine{144                 file,}
\DoxyCodeLine{145                 line,}
\DoxyCodeLine{146                 errorMessage,}
\DoxyCodeLine{147                 \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(err),}
\DoxyCodeLine{148                 cudaGetErrorString(err));}
\DoxyCodeLine{149     \}}
\DoxyCodeLine{150 \}}
\DoxyCodeLine{151 }
\DoxyCodeLine{152 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{153 }
\DoxyCodeLine{154 \textcolor{preprocessor}{\#ifndef MAX}}
\DoxyCodeLine{155 \textcolor{preprocessor}{\#   define MAX(a, b) (a > b ? a : b)}}
\DoxyCodeLine{156 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{157 }
\DoxyCodeLine{158 \textcolor{comment}{// Float To Int conversion}}
\DoxyCodeLine{159 \textcolor{keyword}{inline} \textcolor{keywordtype}{int} ftoi(\textcolor{keywordtype}{float} value) \{}
\DoxyCodeLine{160     \textcolor{keywordflow}{return} (value >= 0 ? \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(value + 0.5) : \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(value -\/ 0.5));}
\DoxyCodeLine{161 \}}
\DoxyCodeLine{162 }
\DoxyCodeLine{163 \textcolor{comment}{// Beginning of GPU Architecture definitions}}
\DoxyCodeLine{164 \textcolor{keyword}{inline} \textcolor{keywordtype}{int} \_ConvertSMVer2Cores(\textcolor{keywordtype}{int} major, \textcolor{keywordtype}{int} minor) \{}
\DoxyCodeLine{165     \textcolor{comment}{// Defines for GPU Architecture types (using the SM version to determine}}
\DoxyCodeLine{166     \textcolor{comment}{// the \# of cores per SM}}
\DoxyCodeLine{167     \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{168         \textcolor{keywordtype}{int} SM; \textcolor{comment}{// 0xMm (hexidecimal notation), M = SM Major version,}}
\DoxyCodeLine{169         \textcolor{comment}{// and m = SM minor version}}
\DoxyCodeLine{170         \textcolor{keywordtype}{int} Cores;}
\DoxyCodeLine{171     \} sSMtoCores;}
\DoxyCodeLine{172 }
\DoxyCodeLine{173     sSMtoCores nGpuArchCoresPerSM[] = \{\{0x30, 192\},}
\DoxyCodeLine{174                                        \{0x32, 192\},}
\DoxyCodeLine{175                                        \{0x35, 192\},}
\DoxyCodeLine{176                                        \{0x37, 192\},}
\DoxyCodeLine{177                                        \{0x50, 128\},}
\DoxyCodeLine{178                                        \{0x52, 128\},}
\DoxyCodeLine{179                                        \{0x53, 128\},}
\DoxyCodeLine{180                                        \{0x60, 64\},}
\DoxyCodeLine{181                                        \{0x61, 128\},}
\DoxyCodeLine{182                                        \{0x62, 128\},}
\DoxyCodeLine{183                                        \{0x70, 64\},}
\DoxyCodeLine{184                                        \{0x72, 64\},}
\DoxyCodeLine{185                                        \{0x75, 64\},}
\DoxyCodeLine{186                                        \{0x80, 64\},}
\DoxyCodeLine{187                                        \{0x86, 128\},}
\DoxyCodeLine{188                                        \{-\/1, -\/1\}\};}
\DoxyCodeLine{189 }
\DoxyCodeLine{190     \textcolor{keywordtype}{int} index = 0;}
\DoxyCodeLine{191 }
\DoxyCodeLine{192     \textcolor{keywordflow}{while} (nGpuArchCoresPerSM[index].SM != -\/1) \{}
\DoxyCodeLine{193         \textcolor{keywordflow}{if} (nGpuArchCoresPerSM[index].SM == ((major << 4) + minor)) \{}
\DoxyCodeLine{194             \textcolor{keywordflow}{return} nGpuArchCoresPerSM[index].Cores;}
\DoxyCodeLine{195         \}}
\DoxyCodeLine{196 }
\DoxyCodeLine{197         index++;}
\DoxyCodeLine{198     \}}
\DoxyCodeLine{199 }
\DoxyCodeLine{200     \textcolor{comment}{// If we don't find the values, we default use the previous one}}
\DoxyCodeLine{201     \textcolor{comment}{// to run properly}}
\DoxyCodeLine{202     printf(}
\DoxyCodeLine{203       \textcolor{stringliteral}{"{}MapSMtoCores for SM \%d.\%d is undefined."{}}}
\DoxyCodeLine{204       \textcolor{stringliteral}{"{}  Default to use \%d Cores/SM\(\backslash\)n"{}},}
\DoxyCodeLine{205       major,}
\DoxyCodeLine{206       minor,}
\DoxyCodeLine{207       nGpuArchCoresPerSM[index -\/ 1].Cores);}
\DoxyCodeLine{208     \textcolor{keywordflow}{return} nGpuArchCoresPerSM[index -\/ 1].Cores;}
\DoxyCodeLine{209 \}}
\DoxyCodeLine{210 }
\DoxyCodeLine{211 \textcolor{keyword}{inline} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\_ConvertSMVer2ArchName(\textcolor{keywordtype}{int} major, \textcolor{keywordtype}{int} minor) \{}
\DoxyCodeLine{212     \textcolor{comment}{// Defines for GPU Architecture types (using the SM version to determine}}
\DoxyCodeLine{213     \textcolor{comment}{// the GPU Arch name)}}
\DoxyCodeLine{214     \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{215         \textcolor{keywordtype}{int} SM; \textcolor{comment}{// 0xMm (hexidecimal notation), M = SM Major version,}}
\DoxyCodeLine{216         \textcolor{comment}{// and m = SM minor version}}
\DoxyCodeLine{217         \textcolor{keyword}{const} \textcolor{keywordtype}{char} *name;}
\DoxyCodeLine{218     \} sSMtoArchName;}
\DoxyCodeLine{219 }
\DoxyCodeLine{220     sSMtoArchName nGpuArchNameSM[] = \{\{0x30, \textcolor{stringliteral}{"{}Kepler"{}}\},}
\DoxyCodeLine{221                                       \{0x32, \textcolor{stringliteral}{"{}Kepler"{}}\},}
\DoxyCodeLine{222                                       \{0x35, \textcolor{stringliteral}{"{}Kepler"{}}\},}
\DoxyCodeLine{223                                       \{0x37, \textcolor{stringliteral}{"{}Kepler"{}}\},}
\DoxyCodeLine{224                                       \{0x50, \textcolor{stringliteral}{"{}Maxwell"{}}\},}
\DoxyCodeLine{225                                       \{0x52, \textcolor{stringliteral}{"{}Maxwell"{}}\},}
\DoxyCodeLine{226                                       \{0x53, \textcolor{stringliteral}{"{}Maxwell"{}}\},}
\DoxyCodeLine{227                                       \{0x60, \textcolor{stringliteral}{"{}Pascal"{}}\},}
\DoxyCodeLine{228                                       \{0x61, \textcolor{stringliteral}{"{}Pascal"{}}\},}
\DoxyCodeLine{229                                       \{0x62, \textcolor{stringliteral}{"{}Pascal"{}}\},}
\DoxyCodeLine{230                                       \{0x70, \textcolor{stringliteral}{"{}Volta"{}}\},}
\DoxyCodeLine{231                                       \{0x72, \textcolor{stringliteral}{"{}Xavier"{}}\},}
\DoxyCodeLine{232                                       \{0x75, \textcolor{stringliteral}{"{}Turing"{}}\},}
\DoxyCodeLine{233                                       \{0x80, \textcolor{stringliteral}{"{}Ampere"{}}\},}
\DoxyCodeLine{234                                       \{0x86, \textcolor{stringliteral}{"{}Ampere"{}}\},}
\DoxyCodeLine{235                                       \{-\/1, \textcolor{stringliteral}{"{}Graphics Device"{}}\}\};}
\DoxyCodeLine{236 }
\DoxyCodeLine{237     \textcolor{keywordtype}{int} index = 0;}
\DoxyCodeLine{238 }
\DoxyCodeLine{239     \textcolor{keywordflow}{while} (nGpuArchNameSM[index].SM != -\/1) \{}
\DoxyCodeLine{240         \textcolor{keywordflow}{if} (nGpuArchNameSM[index].SM == ((major << 4) + minor)) \{}
\DoxyCodeLine{241             \textcolor{keywordflow}{return} nGpuArchNameSM[index].name;}
\DoxyCodeLine{242         \}}
\DoxyCodeLine{243 }
\DoxyCodeLine{244         index++;}
\DoxyCodeLine{245     \}}
\DoxyCodeLine{246 }
\DoxyCodeLine{247     \textcolor{comment}{// If we don't find the values, we default use the previous one}}
\DoxyCodeLine{248     \textcolor{comment}{// to run properly}}
\DoxyCodeLine{249     printf(}
\DoxyCodeLine{250       \textcolor{stringliteral}{"{}MapSMtoArchName for SM \%d.\%d is undefined."{}}}
\DoxyCodeLine{251       \textcolor{stringliteral}{"{}  Default to use \%s\(\backslash\)n"{}},}
\DoxyCodeLine{252       major,}
\DoxyCodeLine{253       minor,}
\DoxyCodeLine{254       nGpuArchNameSM[index -\/ 1].name);}
\DoxyCodeLine{255     \textcolor{keywordflow}{return} nGpuArchNameSM[index -\/ 1].name;}
\DoxyCodeLine{256 \}}
\DoxyCodeLine{257 \textcolor{comment}{// end of GPU Architecture definitions}}
\DoxyCodeLine{258 }
\DoxyCodeLine{259 \textcolor{preprocessor}{\#ifdef \_\_CUDA\_RUNTIME\_H\_\_}}
\DoxyCodeLine{260 }
\DoxyCodeLine{261 \textcolor{comment}{// General GPU Device CUDA Initialization}}
\DoxyCodeLine{262 \textcolor{keyword}{inline} \textcolor{keywordtype}{int} gpuDeviceInit(\textcolor{keywordtype}{int} devID) \{}
\DoxyCodeLine{263     \textcolor{keywordtype}{int} device\_count;}
\DoxyCodeLine{264     checkCudaErrors(cudaGetDeviceCount(\&device\_count));}
\DoxyCodeLine{265 }
\DoxyCodeLine{266     \textcolor{keywordflow}{if} (device\_count == 0) \{}
\DoxyCodeLine{267         fprintf(stderr,}
\DoxyCodeLine{268                 \textcolor{stringliteral}{"{}gpuDeviceInit() CUDA error: "{}}}
\DoxyCodeLine{269                 \textcolor{stringliteral}{"{}no devices supporting CUDA.\(\backslash\)n"{}});}
\DoxyCodeLine{270         exit(EXIT\_FAILURE);}
\DoxyCodeLine{271     \}}
\DoxyCodeLine{272 }
\DoxyCodeLine{273     \textcolor{keywordflow}{if} (devID < 0) \{ devID = 0; \}}
\DoxyCodeLine{274 }
\DoxyCodeLine{275     \textcolor{keywordflow}{if} (devID > device\_count -\/ 1) \{}
\DoxyCodeLine{276         fprintf(stderr, \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{277         fprintf(stderr, \textcolor{stringliteral}{"{}>> \%d CUDA capable GPU device(s) detected. <<\(\backslash\)n"{}}, device\_count);}
\DoxyCodeLine{278         fprintf(stderr,}
\DoxyCodeLine{279                 \textcolor{stringliteral}{"{}>> gpuDeviceInit (-\/device=\%d) is not a valid"{}}}
\DoxyCodeLine{280                 \textcolor{stringliteral}{"{} GPU device. <<\(\backslash\)n"{}},}
\DoxyCodeLine{281                 devID);}
\DoxyCodeLine{282         fprintf(stderr, \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{283         \textcolor{keywordflow}{return} -\/devID;}
\DoxyCodeLine{284     \}}
\DoxyCodeLine{285 }
\DoxyCodeLine{286     \textcolor{keywordtype}{int} computeMode = -\/1, major = 0, minor = 0;}
\DoxyCodeLine{287     checkCudaErrors(cudaDeviceGetAttribute(\&computeMode, cudaDevAttrComputeMode, devID));}
\DoxyCodeLine{288     checkCudaErrors(cudaDeviceGetAttribute(\&major, cudaDevAttrComputeCapabilityMajor, devID));}
\DoxyCodeLine{289     checkCudaErrors(cudaDeviceGetAttribute(\&minor, cudaDevAttrComputeCapabilityMinor, devID));}
\DoxyCodeLine{290     \textcolor{keywordflow}{if} (computeMode == cudaComputeModeProhibited) \{}
\DoxyCodeLine{291         fprintf(stderr,}
\DoxyCodeLine{292                 \textcolor{stringliteral}{"{}Error: device is running in <Compute Mode "{}}}
\DoxyCodeLine{293                 \textcolor{stringliteral}{"{}Prohibited>, no threads can use cudaSetDevice().\(\backslash\)n"{}});}
\DoxyCodeLine{294         \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{295     \}}
\DoxyCodeLine{296 }
\DoxyCodeLine{297     \textcolor{keywordflow}{if} (major < 1) \{}
\DoxyCodeLine{298         fprintf(stderr, \textcolor{stringliteral}{"{}gpuDeviceInit(): GPU device does not support CUDA.\(\backslash\)n"{}});}
\DoxyCodeLine{299         exit(EXIT\_FAILURE);}
\DoxyCodeLine{300     \}}
\DoxyCodeLine{301 }
\DoxyCodeLine{302     checkCudaErrors(cudaSetDevice(devID));}
\DoxyCodeLine{303     printf(\textcolor{stringliteral}{"{}gpuDeviceInit() CUDA Device [\%d]: \(\backslash\)"{}\%s\(\backslash\)n"{}}, devID, \_ConvertSMVer2ArchName(major, minor));}
\DoxyCodeLine{304 }
\DoxyCodeLine{305     \textcolor{keywordflow}{return} devID;}
\DoxyCodeLine{306 \}}
\DoxyCodeLine{307 }
\DoxyCodeLine{308 \textcolor{comment}{// This function returns the best GPU (with maximum GFLOPS)}}
\DoxyCodeLine{309 \textcolor{keyword}{inline} \textcolor{keywordtype}{int} gpuGetMaxGflopsDeviceId() \{}
\DoxyCodeLine{310     \textcolor{keywordtype}{int} current\_device = 0, sm\_per\_multiproc = 0;}
\DoxyCodeLine{311     \textcolor{keywordtype}{int} max\_perf\_device    = 0;}
\DoxyCodeLine{312     \textcolor{keywordtype}{int} device\_count       = 0;}
\DoxyCodeLine{313     \textcolor{keywordtype}{int} devices\_prohibited = 0;}
\DoxyCodeLine{314 }
\DoxyCodeLine{315     uint64\_t max\_compute\_perf = 0;}
\DoxyCodeLine{316     checkCudaErrors(cudaGetDeviceCount(\&device\_count));}
\DoxyCodeLine{317 }
\DoxyCodeLine{318     \textcolor{keywordflow}{if} (device\_count == 0) \{}
\DoxyCodeLine{319         fprintf(stderr,}
\DoxyCodeLine{320                 \textcolor{stringliteral}{"{}gpuGetMaxGflopsDeviceId() CUDA error:"{}}}
\DoxyCodeLine{321                 \textcolor{stringliteral}{"{} no devices supporting CUDA.\(\backslash\)n"{}});}
\DoxyCodeLine{322         exit(EXIT\_FAILURE);}
\DoxyCodeLine{323     \}}
\DoxyCodeLine{324 }
\DoxyCodeLine{325     \textcolor{comment}{// Find the best CUDA capable GPU device}}
\DoxyCodeLine{326     current\_device = 0;}
\DoxyCodeLine{327 }
\DoxyCodeLine{328     \textcolor{keywordflow}{while} (current\_device < device\_count) \{}
\DoxyCodeLine{329         \textcolor{keywordtype}{int} computeMode = -\/1, major = 0, minor = 0;}
\DoxyCodeLine{330         checkCudaErrors(}
\DoxyCodeLine{331           cudaDeviceGetAttribute(\&computeMode, cudaDevAttrComputeMode, current\_device));}
\DoxyCodeLine{332         checkCudaErrors(}
\DoxyCodeLine{333           cudaDeviceGetAttribute(\&major, cudaDevAttrComputeCapabilityMajor, current\_device));}
\DoxyCodeLine{334         checkCudaErrors(}
\DoxyCodeLine{335           cudaDeviceGetAttribute(\&minor, cudaDevAttrComputeCapabilityMinor, current\_device));}
\DoxyCodeLine{336 }
\DoxyCodeLine{337         \textcolor{comment}{// If this GPU is not running on Compute Mode prohibited,}}
\DoxyCodeLine{338         \textcolor{comment}{// then we can add it to the list}}
\DoxyCodeLine{339         \textcolor{keywordflow}{if} (computeMode != cudaComputeModeProhibited) \{}
\DoxyCodeLine{340             \textcolor{keywordflow}{if} (major == 9999 \&\& minor == 9999) \{}
\DoxyCodeLine{341                 sm\_per\_multiproc = 1;}
\DoxyCodeLine{342             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{343                 sm\_per\_multiproc = \_ConvertSMVer2Cores(major, minor);}
\DoxyCodeLine{344             \}}
\DoxyCodeLine{345             \textcolor{keywordtype}{int} multiProcessorCount = 0, clockRate = 0;}
\DoxyCodeLine{346             checkCudaErrors(cudaDeviceGetAttribute(}
\DoxyCodeLine{347               \&multiProcessorCount, cudaDevAttrMultiProcessorCount, current\_device));}
\DoxyCodeLine{348             cudaError\_t result =}
\DoxyCodeLine{349               cudaDeviceGetAttribute(\&clockRate, cudaDevAttrClockRate, current\_device);}
\DoxyCodeLine{350             \textcolor{keywordflow}{if} (result != cudaSuccess) \{}
\DoxyCodeLine{351                 \textcolor{comment}{// If cudaDevAttrClockRate attribute is not supported we}}
\DoxyCodeLine{352                 \textcolor{comment}{// set clockRate as 1, to consider GPU with most SMs and CUDA}}
\DoxyCodeLine{353                 \textcolor{comment}{// Cores.}}
\DoxyCodeLine{354                 \textcolor{keywordflow}{if} (result == cudaErrorInvalidValue) \{}
\DoxyCodeLine{355                     clockRate = 1;}
\DoxyCodeLine{356                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{357                     fprintf(stderr,}
\DoxyCodeLine{358                             \textcolor{stringliteral}{"{}CUDA error at \%s:\%d code=\%d(\%s) \(\backslash\)n"{}},}
\DoxyCodeLine{359                             \_\_FILE\_\_,}
\DoxyCodeLine{360                             \_\_LINE\_\_,}
\DoxyCodeLine{361                             \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\textcolor{keyword}{>}(result),}
\DoxyCodeLine{362                             \_cudaGetErrorEnum(result));}
\DoxyCodeLine{363                     exit(EXIT\_FAILURE);}
\DoxyCodeLine{364                 \}}
\DoxyCodeLine{365             \}}
\DoxyCodeLine{366             uint64\_t compute\_perf = (uint64\_t)multiProcessorCount * sm\_per\_multiproc * clockRate;}
\DoxyCodeLine{367 }
\DoxyCodeLine{368             \textcolor{keywordflow}{if} (compute\_perf > max\_compute\_perf) \{}
\DoxyCodeLine{369                 max\_compute\_perf = compute\_perf;}
\DoxyCodeLine{370                 max\_perf\_device  = current\_device;}
\DoxyCodeLine{371             \}}
\DoxyCodeLine{372         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{373             devices\_prohibited++;}
\DoxyCodeLine{374         \}}
\DoxyCodeLine{375 }
\DoxyCodeLine{376         ++current\_device;}
\DoxyCodeLine{377     \}}
\DoxyCodeLine{378 }
\DoxyCodeLine{379     \textcolor{keywordflow}{if} (devices\_prohibited == device\_count) \{}
\DoxyCodeLine{380         fprintf(stderr,}
\DoxyCodeLine{381                 \textcolor{stringliteral}{"{}gpuGetMaxGflopsDeviceId() CUDA error:"{}}}
\DoxyCodeLine{382                 \textcolor{stringliteral}{"{} all devices have compute mode prohibited.\(\backslash\)n"{}});}
\DoxyCodeLine{383         exit(EXIT\_FAILURE);}
\DoxyCodeLine{384     \}}
\DoxyCodeLine{385 }
\DoxyCodeLine{386     \textcolor{keywordflow}{return} max\_perf\_device;}
\DoxyCodeLine{387 \}}
\DoxyCodeLine{388 }
\DoxyCodeLine{389 \textcolor{comment}{// Initialization code to find the best CUDA Device}}
\DoxyCodeLine{390 \textcolor{keyword}{inline} \textcolor{keywordtype}{int} findCudaDevice(\textcolor{keywordtype}{int} argc, \textcolor{keyword}{const} \textcolor{keywordtype}{char} **argv) \{}
\DoxyCodeLine{391     \textcolor{keywordtype}{int} devID = 0;}
\DoxyCodeLine{392 }
\DoxyCodeLine{393     \textcolor{comment}{// If the command-\/line has a device number specified, use it}}
\DoxyCodeLine{394     \textcolor{keywordflow}{if} (checkCmdLineFlag(argc, argv, \textcolor{stringliteral}{"{}device"{}})) \{}
\DoxyCodeLine{395         devID = getCmdLineArgumentInt(argc, argv, \textcolor{stringliteral}{"{}device="{}});}
\DoxyCodeLine{396 }
\DoxyCodeLine{397         \textcolor{keywordflow}{if} (devID < 0) \{}
\DoxyCodeLine{398             printf(\textcolor{stringliteral}{"{}Invalid command line parameter\(\backslash\)n "{}});}
\DoxyCodeLine{399             exit(EXIT\_FAILURE);}
\DoxyCodeLine{400         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{401             devID = gpuDeviceInit(devID);}
\DoxyCodeLine{402 }
\DoxyCodeLine{403             \textcolor{keywordflow}{if} (devID < 0) \{}
\DoxyCodeLine{404                 printf(\textcolor{stringliteral}{"{}exiting...\(\backslash\)n"{}});}
\DoxyCodeLine{405                 exit(EXIT\_FAILURE);}
\DoxyCodeLine{406             \}}
\DoxyCodeLine{407         \}}
\DoxyCodeLine{408     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{409         \textcolor{comment}{// Otherwise pick the device with highest Gflops/s}}
\DoxyCodeLine{410         devID = gpuGetMaxGflopsDeviceId();}
\DoxyCodeLine{411         checkCudaErrors(cudaSetDevice(devID));}
\DoxyCodeLine{412         \textcolor{keywordtype}{int} major = 0, minor = 0;}
\DoxyCodeLine{413         checkCudaErrors(cudaDeviceGetAttribute(\&major, cudaDevAttrComputeCapabilityMajor, devID));}
\DoxyCodeLine{414         checkCudaErrors(cudaDeviceGetAttribute(\&minor, cudaDevAttrComputeCapabilityMinor, devID));}
\DoxyCodeLine{415         printf(\textcolor{stringliteral}{"{}GPU Device \%d: \(\backslash\)"{}\%s\(\backslash\)"{} with compute capability \%d.\%d\(\backslash\)n\(\backslash\)n"{}},}
\DoxyCodeLine{416                devID,}
\DoxyCodeLine{417                \_ConvertSMVer2ArchName(major, minor),}
\DoxyCodeLine{418                major,}
\DoxyCodeLine{419                minor);}
\DoxyCodeLine{420     \}}
\DoxyCodeLine{421 }
\DoxyCodeLine{422     \textcolor{keywordflow}{return} devID;}
\DoxyCodeLine{423 \}}
\DoxyCodeLine{424 }
\DoxyCodeLine{425 \textcolor{keyword}{inline} \textcolor{keywordtype}{int} findIntegratedGPU() \{}
\DoxyCodeLine{426     \textcolor{keywordtype}{int} current\_device     = 0;}
\DoxyCodeLine{427     \textcolor{keywordtype}{int} device\_count       = 0;}
\DoxyCodeLine{428     \textcolor{keywordtype}{int} devices\_prohibited = 0;}
\DoxyCodeLine{429 }
\DoxyCodeLine{430     checkCudaErrors(cudaGetDeviceCount(\&device\_count));}
\DoxyCodeLine{431 }
\DoxyCodeLine{432     \textcolor{keywordflow}{if} (device\_count == 0) \{}
\DoxyCodeLine{433         fprintf(stderr, \textcolor{stringliteral}{"{}CUDA error: no devices supporting CUDA.\(\backslash\)n"{}});}
\DoxyCodeLine{434         exit(EXIT\_FAILURE);}
\DoxyCodeLine{435     \}}
\DoxyCodeLine{436 }
\DoxyCodeLine{437     \textcolor{comment}{// Find the integrated GPU which is compute capable}}
\DoxyCodeLine{438     \textcolor{keywordflow}{while} (current\_device < device\_count) \{}
\DoxyCodeLine{439         \textcolor{keywordtype}{int} computeMode = -\/1, integrated = -\/1;}
\DoxyCodeLine{440         checkCudaErrors(}
\DoxyCodeLine{441           cudaDeviceGetAttribute(\&computeMode, cudaDevAttrComputeMode, current\_device));}
\DoxyCodeLine{442         checkCudaErrors(cudaDeviceGetAttribute(\&integrated, cudaDevAttrIntegrated, current\_device));}
\DoxyCodeLine{443         \textcolor{comment}{// If GPU is integrated and is not running on Compute Mode prohibited,}}
\DoxyCodeLine{444         \textcolor{comment}{// then cuda can map to GLES resource}}
\DoxyCodeLine{445         \textcolor{keywordflow}{if} (integrated \&\& (computeMode != cudaComputeModeProhibited)) \{}
\DoxyCodeLine{446             checkCudaErrors(cudaSetDevice(current\_device));}
\DoxyCodeLine{447 }
\DoxyCodeLine{448             \textcolor{keywordtype}{int} major = 0, minor = 0;}
\DoxyCodeLine{449             checkCudaErrors(}
\DoxyCodeLine{450               cudaDeviceGetAttribute(\&major, cudaDevAttrComputeCapabilityMajor, current\_device));}
\DoxyCodeLine{451             checkCudaErrors(}
\DoxyCodeLine{452               cudaDeviceGetAttribute(\&minor, cudaDevAttrComputeCapabilityMinor, current\_device));}
\DoxyCodeLine{453             printf(\textcolor{stringliteral}{"{}GPU Device \%d: \(\backslash\)"{}\%s\(\backslash\)"{} with compute capability \%d.\%d\(\backslash\)n\(\backslash\)n"{}},}
\DoxyCodeLine{454                    current\_device,}
\DoxyCodeLine{455                    \_ConvertSMVer2ArchName(major, minor),}
\DoxyCodeLine{456                    major,}
\DoxyCodeLine{457                    minor);}
\DoxyCodeLine{458 }
\DoxyCodeLine{459             \textcolor{keywordflow}{return} current\_device;}
\DoxyCodeLine{460         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{461             devices\_prohibited++;}
\DoxyCodeLine{462         \}}
\DoxyCodeLine{463 }
\DoxyCodeLine{464         current\_device++;}
\DoxyCodeLine{465     \}}
\DoxyCodeLine{466 }
\DoxyCodeLine{467     \textcolor{keywordflow}{if} (devices\_prohibited == device\_count) \{}
\DoxyCodeLine{468         fprintf(stderr,}
\DoxyCodeLine{469                 \textcolor{stringliteral}{"{}CUDA error:"{}}}
\DoxyCodeLine{470                 \textcolor{stringliteral}{"{} No GLES-\/CUDA Interop capable GPU found.\(\backslash\)n"{}});}
\DoxyCodeLine{471         exit(EXIT\_FAILURE);}
\DoxyCodeLine{472     \}}
\DoxyCodeLine{473 }
\DoxyCodeLine{474     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{475 \}}
\DoxyCodeLine{476 }
\DoxyCodeLine{477 \textcolor{comment}{// General check for CUDA GPU SM Capabilities}}
\DoxyCodeLine{478 \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} checkCudaCapabilities(\textcolor{keywordtype}{int} major\_version, \textcolor{keywordtype}{int} minor\_version) \{}
\DoxyCodeLine{479     \textcolor{keywordtype}{int} dev;}
\DoxyCodeLine{480     \textcolor{keywordtype}{int} major = 0, minor = 0;}
\DoxyCodeLine{481 }
\DoxyCodeLine{482     checkCudaErrors(cudaGetDevice(\&dev));}
\DoxyCodeLine{483     checkCudaErrors(cudaDeviceGetAttribute(\&major, cudaDevAttrComputeCapabilityMajor, dev));}
\DoxyCodeLine{484     checkCudaErrors(cudaDeviceGetAttribute(\&minor, cudaDevAttrComputeCapabilityMinor, dev));}
\DoxyCodeLine{485 }
\DoxyCodeLine{486     \textcolor{keywordflow}{if} ((major > major\_version) || (major == major\_version \&\& minor >= minor\_version)) \{}
\DoxyCodeLine{487         printf(\textcolor{stringliteral}{"{}  Device \%d: <\%16s >, Compute SM \%d.\%d detected\(\backslash\)n"{}},}
\DoxyCodeLine{488                dev,}
\DoxyCodeLine{489                \_ConvertSMVer2ArchName(major, minor),}
\DoxyCodeLine{490                major,}
\DoxyCodeLine{491                minor);}
\DoxyCodeLine{492         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{493     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{494         printf(}
\DoxyCodeLine{495           \textcolor{stringliteral}{"{}  No GPU device was found that can support "{}}}
\DoxyCodeLine{496           \textcolor{stringliteral}{"{}CUDA compute capability \%d.\%d.\(\backslash\)n"{}},}
\DoxyCodeLine{497           major\_version,}
\DoxyCodeLine{498           minor\_version);}
\DoxyCodeLine{499         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{500     \}}
\DoxyCodeLine{501 \}}
\DoxyCodeLine{502 }
\DoxyCodeLine{503 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{504 }
\DoxyCodeLine{505 \textcolor{comment}{// end of CUDA Helper Functions}}
\DoxyCodeLine{506 }
\DoxyCodeLine{507 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// COMMON\_HELPER\_CUDA\_H\_}}

\end{DoxyCode}
